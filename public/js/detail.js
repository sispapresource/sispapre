function reload(e,t){"clear"==t&&($("#inputCodigo").val(""),$("#inputCuenta").val("")),$("#modalCargando").modal();var a=[];t_presupuesto_o=t_adendas=t_presupuesto_t=t_comp=t_gastado=t_presupuesto_g=0;var o=$("input[name=_token]").val();$("#fechaDesde").val($("#dateFilterDesde").val()),$("#fechaHasta").val($("#dateFilterHasta").val()),inputCodigo=$("#inputCodigo").val(),inputCuenta=$("#inputCuenta").val(),inputCategoria=$("#inputCategoria").val(),null!=inputCategoria&&(inputCategoria+=","),$.ajax({url:subfolder+"/cuentas",headers:{"X-CSRF-TOKEN":o},type:"GET",data:{codigoFilter:inputCodigo,cuentaFilter:inputCuenta,categoriaFilter:inputCategoria,dateFilterDesde:$("#dateFilterDesde").val(),dateFilterHasta:$("#dateFilterHasta").val(),idCentro:e},datatype:"JSON",success:function(e){$("#modalCargando").modal("hide"),null!=e.cuentas&&$.each(e.cuentas,function(t,o){item={},item.id=o.id_cuenta,item["Código"]=o.id_cuenta,item.Cuenta=o.nombre_cuenta,item.Presupuesto_original=o.presupuesto,item.Adendas=o.adendas,item.Presupuesto_total=o.presupuesto_total,item["%_de_Avance"]=o.porcentaje_avance,item["%_de_Avance_t"]=o.porcentaje_teorico,item.Presupuesto_por_avance=o.presupuestoxavance,item.Comp=toCurrency(o.comp),item.Gastado=toCurrency(o.gastado),item.Presupuesto_por_gastar=o.presupuestoxgastar,item.Costo_proyectado=o.costoproyectado,item.Diferencia_vs_Presupuesto=o.diferenciavspresupuesto,item.level=o.nivel,item.parent=o.id_padre,item.isLeaf=o.isleaf,item.expanded=!1,2==item.level&&(t_presupuesto_o+=item.Presupuesto_original,t_adendas+=item.Adendas,t_presupuesto_t+=item.Presupuesto_total,t_comp+=o.comp,t_gastado+=o.gastado,t_presupuesto_g+=item.Presupuesto_por_gastar);var r="";if(1===o.nivel){var s=o.id_cuenta.replace(o.id_padre,"");if(s=o.id_padre+s.substring(0,1)+"00.",s in e.cuentasDivisoras&&r!==s){var i={};i.id=s,i["Código"]=s,i.Cuenta=e.cuentasDivisoras[s]+"Divisor",i.parent=o.id_padre,a.push(i)}r=s}a.push(item)}),void 0===a||0==a.length?(setTimeout(function(){toastr.options={closeButton:!0,progressBar:!1,positionClass:"toast-top-center",showMethod:"slideDown",timeOut:4e3},toastr.success("No se encontraron registros")},1300),$("#table_list_2_Presupuesto_original h6").html(""),$("#table_list_2_Adendas h6").html(""),$("#table_list_2_Presupuesto_total h6").html(""),$("#table_list_2_Comp h6").html(""),$("#table_list_2_Gastado h6").html(""),$("#table_list_2_Presupuesto_por_gastar h6").html(""),jQuery("#table_list_2").jqGrid("clearGridData").trigger("reloadGrid")):(setTimeout(function(){toastr.options={closeButton:!0,progressBar:!1,positionClass:"toast-top-center",showMethod:"slideDown",timeOut:4e3},1==a.length&&toastr.success(e.cuentas.length+" Registro encontrado"),a.length>1&&toastr.success(e.cuentas.length+" Registros encontrados")},1300),$("#table_list_2_Presupuesto_original h6").html("Total: "+toCurrency(t_presupuesto_o)),$("#table_list_2_Adendas h6").html("Total: "+toCurrency(t_adendas)),$("#table_list_2_Presupuesto_total h6").html("Total: "+toCurrency(t_presupuesto_t)),$("#table_list_2_Comp h6").html("Total: "+toCurrency(t_comp)),$("#table_list_2_Gastado h6").html("Total: "+toCurrency(t_gastado)),$("#table_list_2_Presupuesto_por_gastar h6").html("Total: "+toCurrency(t_presupuesto_g)),$("#table_list_2")[0].addJSONData({total:1,page:1,records:a.length,rows:a}),$("#table_list_2 tbody .jqgrow").each(function(e){"none"!=$(this).css("display")&&$(this).children("td:nth-child(3)").addClass("strong"),a[e].Diferencia_vs_Presupuesto<0?$(this).children("td:nth-child(13)").css("color","red"):$(this).children("td:nth-child(13)").css("color","green")}),$("#table_list_2").jqGrid("footerData","set",{Cuenta:"TOTALES:",Presupuesto_original:t_presupuesto_o,Adendas:t_adendas,Presupuesto_total:t_presupuesto_t,Comp:toCurrency(t_comp),Gastado:toCurrency(t_gastado),Presupuesto_por_gastar:t_presupuesto_g}),$(".footrow").find("a").removeAttr("href").css("cursor","default").css("color","white").css("textDecoration","none"))}})}function toCurrency(e){return"$"+parseFloat(e).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"$1,")}function exportView(e){$("#modalCargando").modal(),t=$("input[name=_token]").val(),id_centro=e,$.ajax({url:subfolder+"/cuentas",headers:{"X-CSRF-TOKEN":t},type:"GET",datatype:"JSON",data:{idCentro:id_centro,search:1},success:function(e){var t="";$.each(e.cuentas,function(a,o){if(item={},item.id=o.id_cuenta,item["Código"]=o.id_cuenta,item.Cuenta=o.nombre_cuenta,item.Presupuesto_original=o.presupuesto,item.Adendas=o.adendas,item.Presupuesto_total=o.presupuesto_total,item["%_de_Avance"]=o.porcentaje_avance,item["%_de_Avance_t"]=o.porcentaje_teorico,item.Presupuesto_por_avance=o.presupuestoxavance,item.Comp=toCurrency(o.comp),item.Gastado=toCurrency(o.gastado),item.Presupuesto_por_gastar=o.presupuestoxgastar,item.Costo_proyectado=o.costoproyectado,item.Diferencia_vs_Presupuesto=o.diferenciavspresupuesto,item.level=o.nivel,item.parent=o.id_padre,item.isLeaf=o.isleaf,item.expanded=!1,2==item.level&&(t_presupuesto_o+=item.Presupuesto_original,t_adendas+=item.Adendas,t_presupuesto_t+=item.Presupuesto_total,t_comp+=o.comp,t_gastado+=o.gastado,t_presupuesto_g+=item.Presupuesto_por_gastar),1===o.nivel){var r=o.id_cuenta.replace(o.id_padre,"");if(r=o.id_padre+r.substring(0,1)+"00.",r in e.cuentasDivisoras&&t!==r){var s={};s.id=r,s["Código"]=r,s.Cuenta=e.cuentasDivisoras[r],s.parent=o.id_padre,mydata.push(s)}t=r}mydata.push(item)})}}),jsonString=JSON.stringify(mydata);var t=$("input[name=_token]").val();$.ajax({url:subfolder+"/export_view_detail",headers:{"X-CSRF-TOKEN":t},type:"POST",data:{idCentro:e,rows:jsonString},success:function(e){$("#modalCargando").modal("hide"),window.location.href=subfolder+e}})}var mydata=[],cuentasDivisoras,t_presupuesto_o=t_adendas=t_presupuesto_t=t_comp=t_gastado=t_presupuesto_g=0;$(document).ready(function(){$(".report").on("click",function(e){e.preventDefault();var t=$(this).attr("href")+"?";t+="desde="+$("#dateFilterDesde").val(),t+="&hasta="+$("#dateFilterHasta").val(),window.location.href=t}),$("#modalCargando").modal();var e,t;e=$("input[name=_token]").val(),t=$("#idCentro").val(),$.ajax({url:subfolder+"/totales/"+t,headers:{"X-CSRF-TOKEN":e},type:"GET",datatype:"JSON",success:function(e){t_presupuesto_o=e.presupuestoOriginal,t_adendas=e.adendas,t_presupuesto_t=e.presupuestoTotal,t_comp=e.comp,t_gastado=e.gastado,t_presupuesto_g=e.porGastar}}),$.ajax({url:subfolder+"/cuentas",headers:{"X-CSRF-TOKEN":e},type:"GET",datatype:"JSON",data:{idCentro:t,search:1},success:function(e){var a="";null==e.cuentas?(alert("No existen cuentas en Presupuesto y Avance para este proyecto"),item={},item.id="",item["Código"]="",item.Cuenta="",item.Presupuesto_original=0,item.Adendas=0,item.Presupuesto_total=0,item["%_de_Avance"]=0,item["%_de_Avance_t"]=0,item.Presupuesto_por_avance=0,item.Comp=toCurrency(0),item.Gastado=toCurrency(0),item.Presupuesto_por_gastar=0,item.Costo_proyectado=0,item.Diferencia_vs_Presupuesto=0,item.level=0,item.parent=0,item.isLeaf=0,item.expanded=!1,mydata.push(item)):$.each(e.cuentas,function(t,o){if(item={},item.id=o.id_cuenta,item["Código"]=o.id_cuenta,item.Cuenta=o.nombre_cuenta,item.Presupuesto_original=o.presupuesto,item.Adendas=o.adendas,item.Presupuesto_total=o.presupuesto_total,item["%_de_Avance"]=o.porcentaje_avance,item["%_de_Avance_t"]=o.porcentaje_teorico,item.Presupuesto_por_avance=o.presupuestoxavance,item.Comp=toCurrency(o.comp),item.Gastado=toCurrency(o.gastado),item.Presupuesto_por_gastar=o.presupuestoxgastar,item.Costo_proyectado=o.costoproyectado,item.Diferencia_vs_Presupuesto=o.diferenciavspresupuesto,item.level=o.nivel,item.parent=o.id_padre,item.isLeaf=o.isleaf,item.expanded=!1,1===o.nivel){var r=o.id_cuenta.replace(o.id_padre,"");if(r=o.id_padre+r.substring(0,1)+"00.",r in e.cuentasDivisoras&&a!==r){var s={};s.id=r,s["Código"]=r,s.Cuenta=e.cuentasDivisoras[r],s.parent=o.id_padre,mydata.push(s)}a=r}mydata.push(item)}),$("#table_list_2").jqGrid({data:mydata,datatype:"local",height:600,autowidth:!0,shrinkToFit:!1,rowNum:10,rowList:[10,20,30],colNames:["id","Codigo","Cuenta","Presupuesto original","Adendas","Presupuesto total","% de avance Fisico","% de avance Teorico","Presupuesto por avance","Comp","Gastado","Presupuesto por gastar","Costo proyectado","Diferencia vs Presupuesto"],colModel:[{name:"id",index:"id",width:100,hidden:!0},{name:"Código",index:"Código",width:160,classes:"strong",align:"center"},{name:"Cuenta",index:"Cuenta",width:210,align:"left"},{name:"Presupuesto_original",width:180,align:"right",formatter:"currency",formatoptions:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,prefix:"$"}},{name:"Adendas",width:130,align:"right",formatter:"currency",formatoptions:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,prefix:"$"}},{name:"Presupuesto_total",width:150,align:"right",formatter:"currency",formatoptions:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,prefix:"$"}},{name:"%_de_Avance",width:150,sorttype:"float",align:"center",formatter:"currency",formatoptions:{thousandsSeparator:",",decimalPlaces:2,suffix:"%"}},{name:"%_de_Avance_t",width:150,sorttype:"float",align:"center",formatter:"currency",formatoptions:{thousandsSeparator:",",decimalPlaces:2,suffix:"%"}},{name:"Presupuesto_por_avance",width:210,sorttype:"float",align:"right",formatter:"currency",formatoptions:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,prefix:"$"}},{name:"Comp",index:"Comp",width:130,align:"right",sorttype:"float",align:"right",formatter:"showlink",formatoptions:{baseLinkUrl:subfolder+"/comprometido",idName:"idCuenta",addParam:"&idCentro="+t}},{name:"Gastado",width:130,align:"right",sorttype:"float",formatter:"showlink",formatoptions:{baseLinkUrl:subfolder+"/gastado",idName:"idCuenta",addParam:"&idCentro="+t}},{name:"Presupuesto_por_gastar",width:200,sorttype:"float",align:"right",formatter:"currency",formatoptions:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,prefix:"$"}},{name:"Costo_proyectado",width:200,sorttype:"float",align:"right",formatter:"currency",formatoptions:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,prefix:"$"}},{name:"Diferencia_vs_Presupuesto",width:220,align:"right",formatter:"currency",formatoptions:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,prefix:"$"}}],pager:"#pager_list_2",viewrecords:!0,hidegrid:!1,scrollOffset:0,sortname:"id",treeGrid:!0,treeGridModel:"adjacency",treedatatype:"local",footerrow:!0,ExpandColumn:"Código",gridComplete:function(){for(var e=$("#table_list_2"),t=e.jqGrid("getDataIDs"),a=0;a<t.length;a++){var o=t[a],r=e.jqGrid("getRowData",o).Cuenta,s=e.jqGrid("getRowData",o).id,i=s.substring(s.length-3,s.length);"00."==i&&(e.jqGrid("setRowData",o,!1,"myclass"),e.jqGrid("setRowData",o,{Cuenta:r,Presupuesto_original:"-",Adendas:"-",Presupuesto_total:"-","%_de_Avance":"-","%_de_Avance_t":"-",Presupuesto_por_avance:"-",Comp:"-",Gastado:"-",Presupuesto_por_gastar:"-",Costo_proyectado:"-",Diferencia_vs_Presupuesto:"-"}))}}}),$("#table_list_2_Presupuesto_original").append("<h6>Total: "+toCurrency(t_presupuesto_o)+"</h6>"),$("#table_list_2_Adendas").append("<h6>Total: "+toCurrency(t_adendas)+"</h6>"),$("#table_list_2_Presupuesto_total").append("<h6>Total: "+toCurrency(t_presupuesto_t)+"</h6>"),$("#table_list_2_Comp").append("<h6>Total: "+toCurrency(t_comp)+"</h6>"),$("#table_list_2_Gastado").append("<h6>Total: "+toCurrency(t_gastado)+"</h6>"),$("#table_list_2_Presupuesto_por_gastar").append("<h6>Total: "+toCurrency(t_presupuesto_g)+"</h6>"),$.jgrid.formatter.currency.decimalSeparator=".",$.jgrid.formatter.currency.thousandsSeparator=",",$.jgrid.formatter.currency.decimalPlaces="2",$(window).bind("resize",function(){var e=$(".jqGrid_wrapper").width();$("#table_list_2").setGridWidth(e)}),$("#table_list_2")[0].addJSONData({total:1,page:1,records:mydata.length,rows:mydata}),$("#table_list_2").navGrid("#pager_list_2",{edit:!1,add:!1,del:!1,search:!1,refresh:!1}).navButtonAdd("#pager_list_2",{caption:"Expandir / Contraer Todo",onClickButton:function(){$("#table_list_2").find(".treeclick").trigger("click")},position:"last",title:"Expandir / Contraer Todo",cursor:"pointer"}),$("#table_list_2 tbody .jqgrow").each(function(e){"none"!=$(this).css("display")&&$(this).children("td:nth-child(3)").addClass("strong"),mydata[e].Diferencia_vs_Presupuesto<0?$(this).children("td:nth-child(13)").css("color","red"):$(this).children("td:nth-child(13)").css("color","green")}),$("#table_list_2").jqGrid("footerData","set",{Cuenta:"TOTALES:",Presupuesto_original:t_presupuesto_o,Adendas:t_adendas,Presupuesto_total:t_presupuesto_t,Comp:toCurrency(t_comp),Gastado:toCurrency(t_gastado),Presupuesto_por_gastar:t_presupuesto_g}),$(".footrow").find("a").removeAttr("href").css("cursor","default").css("color","white").css("textDecoration","none"),$("#modalCargando").modal("hide")}})}),$(function(){$("select").multipleSelect({selectAll:!1,countSelected:"# elementos seleccionados",minimumCountSelected:6,placeholder:"Seleccione la(s) categoria(s)"})});