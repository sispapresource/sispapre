{"version":3,"sources":["update.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"update.js","sourcesContent":["$(document).ready(function () {\n\n    $(\"#modalCargando\").modal();\n\n    var mydata = [\n    ];\n\n    var  token,id_centro;\n    token = $('input[name=_token]').val();\n    id_centro = $('#idCentro').val();\n    \n    $.ajax({\n        url: subfolder +'/cuentasu',\n        headers: {'X-CSRF-TOKEN': token},\n        type: 'GET',\n        datatype: 'JSON',\n        data: {'idCentro':id_centro} ,\n        success: function (resp) {\n\n            $.each(resp.cuentas, function (key, value) {\n                item = {}\n                item [\"id\"] = value.id_cuenta;\n                item [\"cuenta\"] = value.nombre_cuenta;\n                item [\"name\"] = value.presupuesto;\n                item [\"porcentaje\"] = value.porcentaje_avance;\n                item [\"teorico\"] = value.teorico;\n                item [\"update\"] = value.ultima_actualizacion;\n                mydata.push(item);\n            });\n\n            $(\"#table_list_3\").jqGrid({\n                data: mydata,\n                datatype: \"local\",\n                height: 330,\n                myType: 'GET',\n                autowidth: true,\n                shrinkToFit: true,\n                rowNum: 14,\n                rowList: [10, 20, 30],\n                colNames: ['Código', 'Cuenta', 'Presupuesto', '% de Avance Físico', '% de Avance Teórico', 'Última actualización',''],\n                colModel: [\n                    {name: 'id', index: 'id', width: 80, align: 'center', classes: 'strong',sortable: true},\n                    {name: 'cuenta', index: 'cuenta', width: 140, align: 'center'},\n                    {name: 'name', index: 'name', width: 100, align: 'center', formatter:'currency', formatoptions:{decimalSeparator:\".\", thousandsSeparator: \",\", decimalPlaces: 2, prefix: \"$\"}},\n                    {name: 'porcentaje', index: 'porcentaje', width: 120, align: 'center',editable: resp.fisico, formatter:'currency', formatoptions:{thousandsSeparator: \",\", decimalPlaces: 0, suffix: \"%\"},\n                        editoptions:{   \n                            dataInit: function(element) {\n                                $(element).keypress(function(e){\n                                    if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57))\n                                        return false;\n                                });\n                            }\n                        }\n                    },\n                    {name: 'teorico', index: 'teorico', width: 130, align: 'center',editable: resp.teorico, formatter:'currency', formatoptions:{thousandsSeparator: \",\", decimalPlaces: 0, suffix: \"%\"},\n                        editoptions:{   \n                            dataInit: function(element) {\n                                $(element).keypress(function(e){\n                                    if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57))\n                                        return false;\n                                });\n                            }\n                        }\n                    },\n                    {name: 'update', index: 'update', width: 130, sorttype: \"date\", formatter: \"date\", formatoptions : {srcformat : 'Y-m-d H:i',newformat : 'd-m-Y H:i'},align: 'center'},\n                    {name: 'edit', index: 'edit', width: 70, align: 'center'}\n                ],\n                pager: \"#pager_list_3\",\n                gridComplete: function(){ \n                    var ids = $(\"#table_list_3\").jqGrid('getDataIDs'); \n                    for(var i=0;i < ids.length;i++){\n                        var cl = ids[i]; \n                        be = '<a class=\"btn-primary btn-sm\" style=\"color:white;\" type=\"button\" onclick=editbutton(\"'+cl+'\",\"'+id_centro+'\")>Editar</a>';\n                        $(\"#table_list_3\").jqGrid('setRowData',ids[i],{edit:be}); \n                    } \n                },\n                editurl: subfolder +\"/dataupdate\",\n                hidegrid: false,\n                viewrecords: true,\n                scrollOffset: 0\n            });\n            $('#modalCargando').modal('hide');\n        }\n    });\n\n    // Add responsive to jqGrid\n    $(window).bind('resize', function () {\n        var width = $('.jqGrid_wrapper').width();\n        $('#table_list_3').setGridWidth(width);\n    });\n\n});\n\nfunction reload(id_centro,show){\n\n    $(\"#modalCargando\").modal();\n\n    var mydata = [\n    ];\n\n    var token = $('input[name=_token]').val();\n\n    inputCodigo = $('#inputCodigo').val();\n    inputCuenta = $('#inputCuenta').val();\n\n    $.ajax({\n        url: subfolder +'/cuentasu',\n        headers: {'X-CSRF-TOKEN': token},\n        type: 'GET',\n        data: {'codigoFilter':inputCodigo,'cuentaFilter':inputCuenta,'idCentro':id_centro} ,\n        datatype: 'JSON',\n        success: function (resp) {\n\n            $('#modalCargando').modal('hide');\n            if(resp.cuentas != null){\n                $.each(resp.cuentas, function (key, value) {\n\n                    item = {}\n\n                    item [\"id\"] = value.id_cuenta;\n                    item [\"cuenta\"] = value.nombre_cuenta;\n                    item [\"name\"] = value.presupuesto;\n                    item [\"porcentaje\"] = value.porcentaje_avance;\n                    item [\"teorico\"] = value.teorico;\n                    item [\"update\"] = value.ultima_actualizacion;\n                    mydata.push(item);\n\n                });\n            }\n\n            if (mydata === undefined || mydata.length == 0) {\n                if(!show){\n                    setTimeout(function() {\n                        toastr.options = {\n                            closeButton: true,\n                            progressBar: false,\n                            positionClass: \"toast-top-center\",\n                            showMethod: 'slideDown',\n                            timeOut: 4000\n                        };\n                        toastr.success('No se encontraron registros');\n                    }, 1300);\n                }\n\n                jQuery('#table_list_3').jqGrid('clearGridData').trigger('reloadGrid');\n            }else{      \n                setTimeout(function() {\n                    toastr.options = {\n                        closeButton: true,\n                        progressBar: false,\n                        positionClass: \"toast-top-center\",\n                        showMethod: 'slideDown',\n                        timeOut: 4000\n                    };\n                    if(!show){\n                        if(mydata.length==1)\n                            toastr.success(resp.cuentas.length +' Registro encontrado');\n                        if(mydata.length>1)\n                            toastr.success(resp.cuentas.length +' Registros encontrados');\n                    }\n                    if(show)\n                        toastr.success('Actualizacion Correcta');   \n                }, 1300);\n                jQuery('#table_list_3').jqGrid('clearGridData').jqGrid('setGridParam', {data: mydata}).trigger('reloadGrid');\n            }\n        }\n    });\n}\n\nfunction editbutton(cl,id_centro){\n    $('#table_list_3').jqGrid('editRow', cl,{ \n        keys : true, \n        extraparam : {idCentro:id_centro},\n        mtype: \"GET\",\n        successfunc: function(response,postdata) {\n            if(response.responseText=='{\"response\":\"success\"}')\n                reload(id_centro,true);      \n            else{\n                setTimeout(function(){\n                    toastr.options = {\n                        closeButton: true,\n                        progressBar: false,\n                        positionClass: \"toast-top-center\",\n                        showMethod: 'slideDown',\n                        timeOut: 4000\n                    };\n                    toastr.error('Actualizacion Fallida');\n                }, 1300);\n            }    \n        }\n    });\n}\n\n"]}