{"version":3,"sources":["details-edit.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"details-edit.js","sourcesContent":["var mydata = [];\nvar cuentasDivisoras;\nvar cuentasAuto;\nvar t_presupuesto_o = t_adendas = t_presupuesto_t = t_comp = t_gastado = t_presupuesto_g = 0;\nvar lastSel = null;\n$(document).ready(function () {\n    $(\"#table_list_2_Presupuesto_original_2\").css(\"background-color\",\"yellow\");\n    $(\"#table_list_2_Presupuesto_original_2\").css(\"color\",\"#000000\");\n    $(\".report\").on('click',function(e){\n        e.preventDefault();\n        var href = $(this).attr(\"href\")+\"?\";\n        href+=\"desde=\"+$('#dateFilterDesde').val();\n        href+=\"&hasta=\"+$('#dateFilterHasta').val();\n        window.location.href = href;\n    });\n  \n    $(\"#modalCargando\").modal();\n    var  token,id_centro;\n    token = $('input[name=_token]').val();\n    id_centro = $('#idCentro').val();\n    $.ajax({\n        url: subfolder +\"/cuentasDivisoras\",\n        headers: {'X-CSRF-TOKEN':token},\n        type: 'GET',\n        datatype: 'JSON',\n        success: function (resp){\n            cuentasDivisoras = resp;\n        }\n    });\n    $(\"#agregar_cuenta\").autocomplete({\n      source: function( request, response ) {\n        var busqueda=$(\"#agregar_cuenta\").val();\n        $.ajax( {\n          url: subfolder +\"/cuentasAutocompletar\",\n          dataType: \"text\",\n          data: {\n            'idCentro':id_centro,\n            'busqueda': busqueda\n          },\n          type: 'GET',\n          success: function( data ) {\n            var object = $.parseJSON(data);\n            response( object );\n          },\n          select: function( event, ui ) {\n            alert('ok');\n            return false;\n          }\n        } );\n      },\n      minLength: 3\n    } );        \n    $.ajax({\n        url: subfolder +'/cuentas',\n        headers: {'X-CSRF-TOKEN': token},\n        type: 'GET',\n        datatype: 'JSON',\n        data: {'idCentro':id_centro, search:1} ,\n        success: function (resp) {\n            var idDivisorant =\"\";\n            if(resp.cuentas==null){\n                alert('No existen cuentas en Presupuesto y Avance para este proyecto');\n                item = {}                 \n                item [\"id\"] = '';\n                item [\"Código\"] = '';\n                item [\"Cuenta\"] = '';\n                item [\"Presupuesto_original\"] = 0;\n                item [\"Adendas\"] = 0;\n                item [\"Presupuesto_total\"] = 0;\n                item [\"%_de_Avance\"] = 0;\n                item [\"%_de_Avance_t\"] = 0;\n                item [\"Presupuesto_por_avance\"] = 0;\n                item [\"Comp\"] = toCurrency(0);\n                item [\"Gastado\"] = toCurrency(0);\n                item [\"Presupuesto_por_gastar\"] = 0;\n                item [\"Costo_proyectado\"] = 0;\n                item [\"Diferencia_vs_Presupuesto\"] = 0;\n                item [\"level\"] = 0;\n                item [\"parent\"] = 0;\n                item [\"isLeaf\"] = 0;\n                item [\"expanded\"] = false;\n                mydata.push(item);            \n            }\n            else\n            {\n            $.each(resp.cuentas, function (key, value)  {\n                item = {}                 \n                item [\"id\"] = value.id_cuenta;\n                item [\"Código\"] = value.id_cuenta;\n                item [\"Cuenta\"] = value.nombre_cuenta;\n                item [\"Presupuesto_original\"] = value.presupuesto;\n                item [\"Presupuesto_original_2\"] = value.presupuesto;\n                item [\"Adendas\"] = value.adendas;\n                item [\"Presupuesto_total\"] = value.presupuesto_total;\n                item [\"%_de_Avance\"] = value.porcentaje_avance;\n                item [\"%_de_Avance_t\"] = value.porcentaje_teorico;\n                item [\"Presupuesto_por_avance\"] = value.presupuestoxavance;\n                item [\"Comp\"] = toCurrency(value.comp);\n                item [\"Gastado\"] = toCurrency(value.gastado);\n                item [\"Presupuesto_por_gastar\"] = value.presupuestoxgastar;\n                item [\"Costo_proyectado\"] = value.costoproyectado;\n                item [\"Diferencia_vs_Presupuesto\"] = value.diferenciavspresupuesto;\n                item [\"level\"] = value.nivel;\n                item [\"parent\"] = value.id_padre;\n                item [\"isLeaf\"] = value.isleaf;\n                item [\"expanded\"] = false;\n                if(item [\"level\"]==0){\n                    t_presupuesto_o += item [\"Presupuesto_original\"];\n                    t_adendas += item [\"Adendas\"];\n                    t_presupuesto_t += item [\"Presupuesto_total\"];\n                    t_comp += value.comp;\n                    t_gastado += value.gastado;\n                    t_presupuesto_g += item [\"Presupuesto_por_gastar\"];\n                }\n                \n                // console.log(cuentasDivisoras.cuentas);\n                if(value.nivel ===1){\n                    var idDivisor = value.id_cuenta.replace(value.id_padre,\"\");\n                    idDivisor=value.id_padre+idDivisor.substring(0,1)+\"00.\";\n                    // console.log(\"ant \"+idDivisorant+\" act \"+idDivisor);\n                    if((idDivisor in cuentasDivisoras.cuentas)){\n                        if(idDivisorant !== idDivisor){\n                            // console.log(\"se agregará el divisor: \"+idDivisor);\n                            var div={};\n                            div[\"id\"]=idDivisor;\n                            div[\"Código\"]=idDivisor;\n                            div[\"Cuenta\"] =cuentasDivisoras.cuentas[idDivisor];                    \n                            div[\"parent\"] = value.id_padre;\n                            mydata.push(div);\n                        }\n                    }\n                    idDivisorant = idDivisor;\n                }\n                \n                mydata.push(item);\n            });\n        }\n            $(\"#table_list_2\").jqGrid({\n                data: mydata,\n                datatype: \"local\",\n                height: 600,\n                autowidth: true,\n                shrinkToFit: false,\n                rowNum: 10,\n                rowList: [10, 20, 30],\n                colNames:['id','Codigo','Cuenta','Presupuesto original','Adendas','Presupuesto total','Editar presupuesto original'],\n                colModel: [\n                    {name: 'id', editable:false, index: 'id', width: 100, hidden:true},\n                    {name: 'Código', index: 'Código', editable:false, width: 160, classes: 'strong', align: 'center'},\n                    {name: 'Cuenta', index: 'Cuenta', editable:false, width: 210, align: 'left'},\n                    {name: 'Presupuesto_original', editable:false, width: 180, align: 'right', formatter:'currency', formatoptions:{decimalSeparator:\".\", thousandsSeparator: \",\", decimalPlaces: 2, prefix: \"$\"}},\n                    {name: 'Adendas', editable:false, width: 130,align: 'right', formatter:'currency', formatoptions:{decimalSeparator:\".\", thousandsSeparator: \",\", decimalPlaces: 2, prefix: \"$\"}},\n                    {name: 'Presupuesto_total', editable:false, width: 150, align: 'right', formatter:'currency', formatoptions:{decimalSeparator:\".\", thousandsSeparator: \",\", decimalPlaces: 2, prefix: \"$\"}},\n                    {name: 'Presupuesto_original_2', editable:true, width: 180, align: 'right', formatter:'currency', formatoptions:{decimalSeparator:\".\", thousandsSeparator: \",\", decimalPlaces: 2, prefix: \"$\"}}                    \n                ],\n                pager: \"#pager_list_2\",\n                viewrecords: true,\n                hidegrid: false,\n                scrollOffset: 0,\n                sortname: 'id',\n                treeGrid: true,\n                treeGridModel: 'adjacency',\n                treedatatype: \"local\",\n                footerrow: true,\n                ExpandColumn: 'Código',\n                gridComplete: function() {\n                    $(\"#table_list_2_Presupuesto_original_2\").css(\"background-color\",\"yellow\");\n                    $(\"#table_list_2_Presupuesto_original_2\").css(\"color\",\"#000000\");\n                    /*\n                    var res = str.substring(str.length-3,str.length);\n                    if(res=='00.') alert('ok');\n                    */\n                    var grid = $(\"#table_list_2\");\n                    var ids = grid.jqGrid('getDataIDs');\n                    for (var i = 0; i < ids.length; i++) {\n                        var rowId = ids[i];\n                        var cuenta = grid.jqGrid('getRowData',rowId).Cuenta;\n                        var id_cuentas=grid.jqGrid('getRowData',rowId).id;\n                        var res = id_cuentas.substring(id_cuentas.length-3,id_cuentas.length);\n                        \n                        if(res=='00.'){                        \n                        //if(cuenta.includes('Divisor')){ // only add options to \n                            grid.jqGrid('setRowData', rowId, false, 'myclass');\n                            grid.jqGrid('setRowData', rowId, { \n                                \"Cuenta\": cuenta,//.replace(\"Divisor\",\"\"), \n                                \"Presupuesto_original\" : \"-\",\n                                \"Adendas\" : \"-\",\n                                \"Presupuesto_total\" : \"-\",\n                                \"%_de_Avance\" : \"-\",\n                                \"%_de_Avance_t\" : \"-\",\n                                \"Presupuesto_por_avance\" : \"-\",\n                                \"Comp\" : \"-\",\n                                \"Gastado\" : \"-\",\n                                \"Presupuesto_por_gastar\" : \"-\",\n                                \"Costo_proyectado\":\"-\",\n                                \"Diferencia_vs_Presupuesto\" : \"-\"\n                            });\n                        }\n                        //else\n                        //grid.jqGrid('setRowData', rowId, { estado:'' },{background:'white'});\n                        \n                    }\n                },\n                //cellEdit : true,\n                //cellsubmit : 'clientArray',\n                //editurl: subfolder +'/guardarEdit',\n                saveRow:  function(rowId, cellname, value, iRow, iCol){\n                    console.log(value);\n                    console.log(rowId);\n                },\n                onSelectRow: function(id) {\n                    var grid = $(\"#table_list_2\");\n                    if (id && id !== lastSel) {\n                        grid.jqGrid('restoreRow',lastSel);\n                        var cm = grid.jqGrid('getColProp','Name');\n                        var data = grid.jqGrid('getRowData',id)\n                        console.log(data);\n                        if(data.isLeaf===\"true\"){\n                            cm.editable = false;\n                            // grid.jqGrid('editRow', id, true, null, null, 'clientArray');\n                            var editparameters = {\n                                \"keys\" : true,\n                                \"oneditfunc\" : null,\n                                \"successfunc\" : null,\n                                \"url\" :subfolder +'/guardarEdit' /* \"clientArray\" */,\n                                \"extraparam\" : {'_token': $('input[name=_token]').val(),'id_centro':$('#idCentro').val()},\n                                \"aftersavefunc\" : function(rowId,response){\n                                    console.log(response);\n                                },\n                                \"errorfunc\": null,\n                                \"afterrestorefunc\" : null,\n                                \"restoreAfterError\" : true,\n                                \"mtype\" : \"POST\"\n                            }\n                            grid.jqGrid('editRow', id, editparameters);\n                            cm.editable = true;\n                        }\n                        lastSel = id;\n                    }\n                }\n            });\n            \n            // add totales\n            $(\"#table_list_2_Presupuesto_original\").append('<h6>Total: '+toCurrency(t_presupuesto_o)+'</h6>');\n            $(\"#table_list_2_Adendas\").append('<h6>Total: '+toCurrency(t_adendas)+'</h6>');\n            $(\"#table_list_2_Presupuesto_total\").append('<h6>Total: '+toCurrency(t_presupuesto_t)+'</h6>');\n            $(\"#table_list_2_Comp\").append('<h6>Total: '+toCurrency(t_comp)+'</h6>');\n            $(\"#table_list_2_Gastado\").append('<h6>Total: '+toCurrency(t_gastado)+'</h6>');\n            $(\"#table_list_2_Presupuesto_por_gastar\").append('<h6>Total: '+toCurrency(t_presupuesto_g)+'</h6>');\n            // Add responsive to jqGrid\n            \n            $.jgrid.formatter.currency.decimalSeparator='.';\n            $.jgrid.formatter.currency.thousandsSeparator=',';\n            $.jgrid.formatter.currency.decimalPlaces='2';\n            $(window).bind('resize', function () {\n                var width = $('.jqGrid_wrapper').width();\n                $('#table_list_2').setGridWidth(width);\n            });\n            $(\"#table_list_2\")[0].addJSONData({\n                total: 1,\n                page: 1,\n                records: mydata.length,\n                rows: mydata\n            });\n            $(\"#table_list_2\")\n            .navGrid('#pager_list_2',{edit:false,add:false,del:false,search:false,refresh:false})\n            .navButtonAdd('#pager_list_2',{\n                caption: \"Expandir / Contraer Todo\",\n                onClickButton: function() {\n                    $(\"#table_list_2\").find(\".treeclick\").trigger('click');\n                },\n                position: \"last\",\n                title: \"Expandir / Contraer Todo\",\n                cursor: \"pointer\"\n            });\n            \n            $(\"#table_list_2 tbody .jqgrow\").each(function (index){\n                if($(this).css(\"display\") != \"none\") // strong to cuentas padre,\n                    $(this).children('td:nth-child(3)').addClass('strong'); \n                if((mydata[index]['Diferencia_vs_Presupuesto'])<0) // red to Diferencia_vs_Presupuesto negativo \n                    $(this).children('td:nth-child(13)').css('color', 'red');\n                else // green to Diferencia_vs_Presupuesto positivo\n                    $(this).children('td:nth-child(13)').css('color', 'green');\n            });\n            // add totales in footer\n            $(\"#table_list_2\").jqGrid('footerData','set', {Cuenta: 'TOTALES:', Presupuesto_original: t_presupuesto_o, Adendas: t_adendas, Presupuesto_total: t_presupuesto_t, Comp: toCurrency(t_comp), Gastado: toCurrency(t_gastado), Presupuesto_por_gastar: t_presupuesto_g});\n            // remove links in footer\n            $(\".footrow\").find(\"a\").removeAttr(\"href\").css(\"cursor\",\"default\").css('color', 'white').css('textDecoration','none');\n            $('#modalCargando').modal('hide');            \n        }\n    });\n    \n});\n\nfunction reload(id_centro,action){\n    if(action == 'clear'){\n        $('#inputCodigo').val('');\n        $('#inputCuenta').val('');\n    }\n    $(\"#modalCargando\").modal();\n    var mydata = [];\n    t_presupuesto_o = t_adendas = t_presupuesto_t = t_comp = t_gastado = t_presupuesto_g = 0;\n    var token = $('input[name=_token]').val();\n    \n    $('#fechaDesde').val($('#dateFilterDesde').val());\n    $('#fechaHasta').val($('#dateFilterHasta').val());\n    \n    \n    inputCodigo = $('#inputCodigo').val();\n    inputCuenta = $('#inputCuenta').val();\n    inputCategoria = $('#inputCategoria').val();\n    if(inputCategoria!=null)\n        inputCategoria+=',';\n    \n    $.ajax({\n        url:subfolder + '/cuentas',\n        headers: {'X-CSRF-TOKEN': token},\n        type: 'GET',\n        data: {'codigoFilter':inputCodigo,'cuentaFilter':inputCuenta,'categoriaFilter':inputCategoria, 'dateFilterDesde': $('#dateFilterDesde').val(), 'dateFilterHasta': $('#dateFilterHasta').val(), 'idCentro':id_centro} ,\n        datatype: 'JSON',\n        success: function (resp) {\n            $('#modalCargando').modal('hide');\n            if(resp.cuentas==null){\n                alert('No existen cuentas en Presupuesto y Avance para este proyecto');\n                item = {}                 \n                item [\"id\"] = '';\n                item [\"Código\"] = '';\n                item [\"Cuenta\"] = '';\n                item [\"Presupuesto_original\"] = 0;\n                item [\"Adendas\"] = 0;\n                item [\"Presupuesto_total\"] = 0;\n                item [\"%_de_Avance\"] = 0;\n                item [\"%_de_Avance_t\"] = 0;\n                item [\"Presupuesto_por_avance\"] = 0;\n                item [\"Comp\"] = toCurrency(0);\n                item [\"Gastado\"] = toCurrency(0);\n                item [\"Presupuesto_por_gastar\"] = 0;\n                item [\"Costo_proyectado\"] = 0;\n                item [\"Diferencia_vs_Presupuesto\"] = 0;\n                item [\"level\"] = 0;\n                item [\"parent\"] = 0;\n                item [\"isLeaf\"] = 0;\n                item [\"expanded\"] = false;\n                mydata.push(item);            \n            }\n            else{\n                $.each(resp.cuentas, function (key, value) {\n                    item = {}                    \n                    item [\"id\"] = value.id_cuenta;\n                    item [\"Código\"] = value.id_cuenta;\n                    item [\"Cuenta\"] = value.nombre_cuenta;\n                    item [\"Presupuesto_original\"] = value.presupuesto;\n                    item [\"Presupuesto_original_2\"] = value.presupuesto;\n                    item [\"Adendas\"] = value.adendas;\n                    item [\"Presupuesto_total\"] = value.presupuesto_total;\n                    item [\"%_de_Avance\"] = value.porcentaje_avance;\n                    item [\"%_de_Avance_t\"] = value.porcentaje_teorico;\n                    item [\"Presupuesto_por_avance\"] = value.presupuestoxavance;\n                    item [\"Comp\"] = toCurrency(value.comp);\n                    item [\"Gastado\"] = toCurrency(value.gastado);\n                    item [\"Presupuesto_por_gastar\"] = value.presupuestoxgastar;\n                    item [\"Costo_proyectado\"] = value.costoproyectado;\n                    item [\"Diferencia_vs_Presupuesto\"] = value.diferenciavspresupuesto;\n                    item [\"level\"] = value.nivel;\n                    item [\"parent\"] = value.id_padre;\n                    item [\"isLeaf\"] = value.isleaf;\n                    item [\"expanded\"] = false;      \n                    if(item [\"level\"]==0){\n                        t_presupuesto_o += item [\"Presupuesto_original\"];\n                        t_adendas += item [\"Adendas\"];\n                        t_presupuesto_t += item [\"Presupuesto_total\"];\n                        t_comp += value.comp;\n                        t_gastado += value.gastado;\n                        t_presupuesto_g += item [\"Presupuesto_por_gastar\"];\n                    }      \n                    \n                    //console.log(cuentasDivisoras.cuentas);\n                    var idDivisorant =\"\";\n                    if(value.nivel ===1){\n                        var idDivisor = value.id_cuenta.replace(value.id_padre,\"\");\n                        idDivisor=value.id_padre+idDivisor.substring(0,1)+\"00.\";\n                        // console.log(\"ant \"+idDivisorant+\" act \"+idDivisor);\n                        if((idDivisor in cuentasDivisoras.cuentas)){\n                            if(idDivisorant !== idDivisor){\n                                //console.log(\"se agregará el divisor: \"+idDivisor);\n                                var div={};\n                                div[\"id\"]=idDivisor;\n                                div[\"Código\"]=idDivisor;\n                                div[\"Cuenta\"] =cuentasDivisoras.cuentas[idDivisor]+\"Divisor\";                    \n                                div[\"parent\"] = value.id_padre;\n                                mydata.push(div);\n                            }\n                        }\n                        idDivisorant = idDivisor;\n                    }\n                    \n                    \n                    mydata.push(item);\n                });\n            }\n            if (mydata === undefined || mydata.length == 0) {\n                setTimeout(function() {\n                    toastr.options = {\n                        closeButton: true,\n                        progressBar: false,\n                        positionClass: \"toast-top-center\",\n                        showMethod: 'slideDown',\n                        timeOut: 4000\n                    };\n                    toastr.success('No se encontraron registros');\n                }, 1300);\n                //delete totales\n                $(\"#table_list_2_Presupuesto_original h6\").html('');\n                $(\"#table_list_2_Adendas h6\").html('');\n                $(\"#table_list_2_Presupuesto_total h6\").html('');\n                $(\"#table_list_2_Comp h6\").html('');\n                $(\"#table_list_2_Gastado h6\").html('');\n                $(\"#table_list_2_Presupuesto_por_gastar h6\").html('');\n                jQuery('#table_list_2').jqGrid('clearGridData').trigger('reloadGrid');\n            }else{\n                setTimeout(function() {\n                    toastr.options = {\n                        closeButton: true,\n                        progressBar: false,\n                        positionClass: \"toast-top-center\",\n                        showMethod: 'slideDown',\n                        timeOut: 4000\n                    };\n                    if(mydata.length==1)\n                        toastr.success(resp.cuentas.length +' Registro encontrado');\n                    if(mydata.length>1)\n                        toastr.success(resp.cuentas.length +' Registros encontrados');\n                }, 1300);\n                // add totales\n                $(\"#table_list_2_Presupuesto_original h6\").html('Total: '+toCurrency(t_presupuesto_o));\n                $(\"#table_list_2_Adendas h6\").html('Total: '+toCurrency(t_adendas));\n                $(\"#table_list_2_Presupuesto_total h6\").html('Total: '+toCurrency(t_presupuesto_t));\n                $(\"#table_list_2_Comp h6\").html('Total: '+toCurrency(t_comp));\n                $(\"#table_list_2_Gastado h6\").html('Total: '+toCurrency(t_gastado));\n                $(\"#table_list_2_Presupuesto_por_gastar h6\").html('Total: '+toCurrency(t_presupuesto_g));\n                $(\"#table_list_2\")[0].addJSONData({\n                    total: 1,\n                    page: 1,\n                    records: mydata.length,\n                    rows: mydata\n                });\n                // strong to cuentas padre\n                $(\"#table_list_2 tbody .jqgrow\").each(function (index){\n                    if($(this).css(\"display\") != \"none\")\n                        $(this).children('td:nth-child(3)').addClass('strong'); \n                    if((mydata[index]['Diferencia_vs_Presupuesto'])<0) // red to Diferencia_vs_Presupuesto negativo \n                        $(this).children('td:nth-child(13)').css('color', 'red');\n                    else // green to Diferencia_vs_Presupuesto positivo\n                        $(this).children('td:nth-child(13)').css('color', 'green');\n                });\n                // add totales in footer\n                $(\"#table_list_2\").jqGrid('footerData','set', {Cuenta: 'TOTALES:', Presupuesto_original: t_presupuesto_o, Adendas: t_adendas, Presupuesto_total: t_presupuesto_t, Comp: toCurrency(t_comp), Gastado: toCurrency(t_gastado), Presupuesto_por_gastar: t_presupuesto_g});\n                // remove links in footer\n                $(\".footrow\").find(\"a\").removeAttr(\"href\").css(\"cursor\",\"default\").css('color', 'white').css('textDecoration','none');\n            }\n        }\n    });\n}\n$(function () {\n    $('select').multipleSelect({selectAll: false,\n        countSelected: \"# elementos seleccionados\",\n        minimumCountSelected: 6,\n        placeholder: 'Seleccione las cuentas a agregar'});\n    });\n    function toCurrency(value){\n        return \"$\"+value.toFixed(2).replace(/(\\d)(?=(\\d{3})+\\.)/g, '$1,');\n    }\n    function exportView(idCentro){\n        $(\"#modalCargando\").modal();\n        token = $('input[name=_token]').val();\n        id_centro = idCentro;\n        $.ajax({\n            url: subfolder +\"/cuentasDivisoras\",\n            headers: {'X-CSRF-TOKEN':token},\n            type: 'GET',\n            datatype: 'JSON',\n            success: function (resp){\n                cuentasDivisoras = resp;\n            }\n        });\n        $.ajax({\n            url: subfolder +'/cuentas',\n            headers: {'X-CSRF-TOKEN': token},\n            type: 'GET',\n            datatype: 'JSON',\n            data: {'idCentro':id_centro, search:1} ,\n            success: function (resp) {\n                var idDivisorant =\"\";\n                if(resp.cuentas==null){\n                    alert('No existen cuentas en Presupuesto y Avance para este proyecto');\n                    item = {}                 \n                    item [\"id\"] = '';\n                    item [\"Código\"] = '';\n                    item [\"Cuenta\"] = '';\n                    item [\"Presupuesto_original\"] = 0;\n                    item [\"Adendas\"] = 0;\n                    item [\"Presupuesto_total\"] = 0;\n                    item [\"%_de_Avance\"] = 0;\n                    item [\"%_de_Avance_t\"] = 0;\n                    item [\"Presupuesto_por_avance\"] = 0;\n                    item [\"Comp\"] = toCurrency(0);\n                    item [\"Gastado\"] = toCurrency(0);\n                    item [\"Presupuesto_por_gastar\"] = 0;\n                    item [\"Costo_proyectado\"] = 0;\n                    item [\"Diferencia_vs_Presupuesto\"] = 0;\n                    item [\"level\"] = 0;\n                    item [\"parent\"] = 0;\n                    item [\"isLeaf\"] = 0;\n                    item [\"expanded\"] = false;\n                    mydata.push(item);            \n                }\n                else\n                {\n                $.each(resp.cuentas, function (key, value)  {\n                    item = {}                 \n                    item [\"id\"] = value.id_cuenta;\n                    item [\"Código\"] = value.id_cuenta;\n                    item [\"Cuenta\"] = value.nombre_cuenta;\n                    item [\"Presupuesto_original\"] = value.presupuesto;\n                    item [\"Presupuesto_original_2\"] = value.presupuesto;\n                    item [\"Adendas\"] = value.adendas;\n                    item [\"Presupuesto_total\"] = value.presupuesto_total;\n                    item [\"%_de_Avance\"] = value.porcentaje_avance;\n                    item [\"%_de_Avance_t\"] = value.porcentaje_teorico;\n                    item [\"Presupuesto_por_avance\"] = value.presupuestoxavance;\n                    item [\"Comp\"] = toCurrency(value.comp);\n                    item [\"Gastado\"] = toCurrency(value.gastado);\n                    item [\"Presupuesto_por_gastar\"] = value.presupuestoxgastar;\n                    item [\"Costo_proyectado\"] = value.costoproyectado;\n                    item [\"Diferencia_vs_Presupuesto\"] = value.diferenciavspresupuesto;\n                    item [\"level\"] = value.nivel;\n                    item [\"parent\"] = value.id_padre;\n                    item [\"isLeaf\"] = value.isleaf;\n                    item [\"expanded\"] = false;\n                    if(item [\"level\"]==0){\n                        t_presupuesto_o += item [\"Presupuesto_original\"];\n                        t_adendas += item [\"Adendas\"];\n                        t_presupuesto_t += item [\"Presupuesto_total\"];\n                        t_comp += value.comp;\n                        t_gastado += value.gastado;\n                        t_presupuesto_g += item [\"Presupuesto_por_gastar\"];\n                    }\n                    \n                    // console.log(cuentasDivisoras.cuentas);\n                    if(value.nivel ===1){\n                        var idDivisor = value.id_cuenta.replace(value.id_padre,\"\");\n                        idDivisor=value.id_padre+idDivisor.substring(0,1)+\"00.\";\n                        // console.log(\"ant \"+idDivisorant+\" act \"+idDivisor);\n                        if((idDivisor in cuentasDivisoras.cuentas)){\n                            if(idDivisorant !== idDivisor){\n                                // console.log(\"se agregará el divisor: \"+idDivisor);\n                                var div={};\n                                div[\"id\"]=idDivisor;\n                                div[\"Código\"]=idDivisor;\n                                div[\"Cuenta\"] =cuentasDivisoras.cuentas[idDivisor];                    \n                                div[\"parent\"] = value.id_padre;\n                                mydata.push(div);\n                            }\n                        }\n                        idDivisorant = idDivisor;\n                    }\n                    \n                    mydata.push(item);\n                }); \n            }\n            }       \n        });\n        jsonString = JSON.stringify(mydata);\n        var token = $('input[name=_token]').val();\n        $.ajax({\n            url: subfolder +'/export_view_detail',\n            headers: {'X-CSRF-TOKEN': token},\n            type: 'POST',\n            data:  {idCentro:idCentro, rows:jsonString},\n            success:  function(response){\n                $('#modalCargando').modal('hide');\n                window.location.href = subfolder + response;\n            }\n        });\n     \n    }"]}