function reload(e,t){"clear"==t&&($("#inputCodigo").val(""),$("#inputCuenta").val("")),$("#modalCargando").modal();var a=[];t_presupuesto_o=t_adendas=t_presupuesto_t=t_comp=t_gastado=t_presupuesto_g=0;var o=$("input[name=_token]").val();$("#fechaDesde").val($("#dateFilterDesde").val()),$("#fechaHasta").val($("#dateFilterHasta").val()),inputCodigo=$("#inputCodigo").val(),inputCuenta=$("#inputCuenta").val(),inputCategoria=$("#inputCategoria").val(),null!=inputCategoria&&(inputCategoria+=","),$.ajax({url:subfolder+"/cuentas",headers:{"X-CSRF-TOKEN":o},type:"GET",data:{codigoFilter:inputCodigo,cuentaFilter:inputCuenta,categoriaFilter:inputCategoria,dateFilterDesde:$("#dateFilterDesde").val(),dateFilterHasta:$("#dateFilterHasta").val(),idCentro:e},datatype:"JSON",success:function(e){$("#modalCargando").modal("hide"),null==e.cuentas?(alert("No existen cuentas en Presupuesto y Avance para este proyecto"),item={},item.id="",item["Código"]="",item.Cuenta="",item.Presupuesto_original=0,item.Adendas=0,item.Presupuesto_total=0,item["%_de_Avance"]=0,item["%_de_Avance_t"]=0,item.Presupuesto_por_avance=0,item.Comp=toCurrency(0),item.Gastado=toCurrency(0),item.Presupuesto_por_gastar=0,item.Costo_proyectado=0,item.Diferencia_vs_Presupuesto=0,item.level=0,item.parent=0,item.isLeaf=0,item.expanded=!1,a.push(item)):$.each(e.cuentas,function(e,t){item={},item.id=t.id_cuenta,item["Código"]=t.id_cuenta,item.Cuenta=t.nombre_cuenta,item.Presupuesto_original=t.presupuesto,item.Presupuesto_original_2=t.presupuesto,item.Adendas=t.adendas,item.Presupuesto_total=t.presupuesto_total,item["%_de_Avance"]=t.porcentaje_avance,item["%_de_Avance_t"]=t.porcentaje_teorico,item.Presupuesto_por_avance=t.presupuestoxavance,item.Comp=toCurrency(t.comp),item.Gastado=toCurrency(t.gastado),item.Presupuesto_por_gastar=t.presupuestoxgastar,item.Costo_proyectado=t.costoproyectado,item.Diferencia_vs_Presupuesto=t.diferenciavspresupuesto,item.level=t.nivel,item.parent=t.id_padre,item.isLeaf=t.isleaf,item.expanded=!1,0==item.level&&(t_presupuesto_o+=item.Presupuesto_original,t_adendas+=item.Adendas,t_presupuesto_t+=item.Presupuesto_total,t_comp+=t.comp,t_gastado+=t.gastado,t_presupuesto_g+=item.Presupuesto_por_gastar);var o="";if(1===t.nivel){var s=t.id_cuenta.replace(t.id_padre,"");if(s=t.id_padre+s.substring(0,1)+"00.",s in cuentasDivisoras.cuentas&&o!==s){var r={};r.id=s,r["Código"]=s,r.Cuenta=cuentasDivisoras.cuentas[s]+"Divisor",r.parent=t.id_padre,a.push(r)}o=s}a.push(item)}),void 0===a||0==a.length?(setTimeout(function(){toastr.options={closeButton:!0,progressBar:!1,positionClass:"toast-top-center",showMethod:"slideDown",timeOut:4e3},toastr.success("No se encontraron registros")},1300),$("#table_list_2_Presupuesto_original h6").html(""),$("#table_list_2_Adendas h6").html(""),$("#table_list_2_Presupuesto_total h6").html(""),$("#table_list_2_Comp h6").html(""),$("#table_list_2_Gastado h6").html(""),$("#table_list_2_Presupuesto_por_gastar h6").html(""),jQuery("#table_list_2").jqGrid("clearGridData").trigger("reloadGrid")):(setTimeout(function(){toastr.options={closeButton:!0,progressBar:!1,positionClass:"toast-top-center",showMethod:"slideDown",timeOut:4e3},1==a.length&&toastr.success(e.cuentas.length+" Registro encontrado"),a.length>1&&toastr.success(e.cuentas.length+" Registros encontrados")},1300),$("#table_list_2_Presupuesto_original h6").html("Total: "+toCurrency(t_presupuesto_o)),$("#table_list_2_Adendas h6").html("Total: "+toCurrency(t_adendas)),$("#table_list_2_Presupuesto_total h6").html("Total: "+toCurrency(t_presupuesto_t)),$("#table_list_2_Comp h6").html("Total: "+toCurrency(t_comp)),$("#table_list_2_Gastado h6").html("Total: "+toCurrency(t_gastado)),$("#table_list_2_Presupuesto_por_gastar h6").html("Total: "+toCurrency(t_presupuesto_g)),$("#table_list_2")[0].addJSONData({total:1,page:1,records:a.length,rows:a}),$("#table_list_2 tbody .jqgrow").each(function(e){"none"!=$(this).css("display")&&$(this).children("td:nth-child(3)").addClass("strong"),a[e].Diferencia_vs_Presupuesto<0?$(this).children("td:nth-child(13)").css("color","red"):$(this).children("td:nth-child(13)").css("color","green")}),$("#table_list_2").jqGrid("footerData","set",{Cuenta:"TOTALES:",Presupuesto_original:t_presupuesto_o,Adendas:t_adendas,Presupuesto_total:t_presupuesto_t,Comp:toCurrency(t_comp),Gastado:toCurrency(t_gastado),Presupuesto_por_gastar:t_presupuesto_g}),$(".footrow").find("a").removeAttr("href").css("cursor","default").css("color","white").css("textDecoration","none"))}})}function toCurrency(e){return"$"+e.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"$1,")}function exportView(e){$("#modalCargando").modal(),t=$("input[name=_token]").val(),id_centro=e,$.ajax({url:subfolder+"/cuentasDivisoras",headers:{"X-CSRF-TOKEN":t},type:"GET",datatype:"JSON",success:function(e){cuentasDivisoras=e}}),$.ajax({url:subfolder+"/cuentas",headers:{"X-CSRF-TOKEN":t},type:"GET",datatype:"JSON",data:{idCentro:id_centro,search:1},success:function(e){var t="";null==e.cuentas?(alert("No existen cuentas en Presupuesto y Avance para este proyecto"),item={},item.id="",item["Código"]="",item.Cuenta="",item.Presupuesto_original=0,item.Adendas=0,item.Presupuesto_total=0,item["%_de_Avance"]=0,item["%_de_Avance_t"]=0,item.Presupuesto_por_avance=0,item.Comp=toCurrency(0),item.Gastado=toCurrency(0),item.Presupuesto_por_gastar=0,item.Costo_proyectado=0,item.Diferencia_vs_Presupuesto=0,item.level=0,item.parent=0,item.isLeaf=0,item.expanded=!1,mydata.push(item)):$.each(e.cuentas,function(e,a){if(item={},item.id=a.id_cuenta,item["Código"]=a.id_cuenta,item.Cuenta=a.nombre_cuenta,item.Presupuesto_original=a.presupuesto,item.Presupuesto_original_2=a.presupuesto,item.Adendas=a.adendas,item.Presupuesto_total=a.presupuesto_total,item["%_de_Avance"]=a.porcentaje_avance,item["%_de_Avance_t"]=a.porcentaje_teorico,item.Presupuesto_por_avance=a.presupuestoxavance,item.Comp=toCurrency(a.comp),item.Gastado=toCurrency(a.gastado),item.Presupuesto_por_gastar=a.presupuestoxgastar,item.Costo_proyectado=a.costoproyectado,item.Diferencia_vs_Presupuesto=a.diferenciavspresupuesto,item.level=a.nivel,item.parent=a.id_padre,item.isLeaf=a.isleaf,item.expanded=!1,0==item.level&&(t_presupuesto_o+=item.Presupuesto_original,t_adendas+=item.Adendas,t_presupuesto_t+=item.Presupuesto_total,t_comp+=a.comp,t_gastado+=a.gastado,t_presupuesto_g+=item.Presupuesto_por_gastar),1===a.nivel){var o=a.id_cuenta.replace(a.id_padre,"");if(o=a.id_padre+o.substring(0,1)+"00.",o in cuentasDivisoras.cuentas&&t!==o){var s={};s.id=o,s["Código"]=o,s.Cuenta=cuentasDivisoras.cuentas[o],s.parent=a.id_padre,mydata.push(s)}t=o}mydata.push(item)})}}),jsonString=JSON.stringify(mydata);var t=$("input[name=_token]").val();$.ajax({url:subfolder+"/export_view_detail",headers:{"X-CSRF-TOKEN":t},type:"POST",data:{idCentro:e,rows:jsonString},success:function(e){$("#modalCargando").modal("hide"),window.location.href=subfolder+e}})}var mydata=[],cuentasDivisoras,cuentasAuto,t_presupuesto_o=t_adendas=t_presupuesto_t=t_comp=t_gastado=t_presupuesto_g=0,lastSel=null;$(document).ready(function(){$("#table_list_2_Presupuesto_original_2").css("background-color","yellow"),$("#table_list_2_Presupuesto_original_2").css("color","#000000"),$(".report").on("click",function(e){e.preventDefault();var t=$(this).attr("href")+"?";t+="desde="+$("#dateFilterDesde").val(),t+="&hasta="+$("#dateFilterHasta").val(),window.location.href=t}),$("#modalCargando").modal();var e,t;e=$("input[name=_token]").val(),t=$("#idCentro").val(),$.ajax({url:subfolder+"/cuentasDivisoras",headers:{"X-CSRF-TOKEN":e},type:"GET",datatype:"JSON",success:function(e){cuentasDivisoras=e}}),$("#agregar_cuenta").autocomplete({source:function(e,a){var o=$("#agregar_cuenta").val();$.ajax({url:subfolder+"/cuentasAutocompletar",dataType:"text",data:{idCentro:t,busqueda:o},type:"GET",success:function(e){var t=$.parseJSON(e);a(t)},select:function(e,t){return alert("ok"),!1}})},minLength:3}),$.ajax({url:subfolder+"/cuentas",headers:{"X-CSRF-TOKEN":e},type:"GET",datatype:"JSON",data:{idCentro:t,search:1},success:function(e){var t="";null==e.cuentas?(alert("No existen cuentas en Presupuesto y Avance para este proyecto"),item={},item.id="",item["Código"]="",item.Cuenta="",item.Presupuesto_original=0,item.Adendas=0,item.Presupuesto_total=0,item["%_de_Avance"]=0,item["%_de_Avance_t"]=0,item.Presupuesto_por_avance=0,item.Comp=toCurrency(0),item.Gastado=toCurrency(0),item.Presupuesto_por_gastar=0,item.Costo_proyectado=0,item.Diferencia_vs_Presupuesto=0,item.level=0,item.parent=0,item.isLeaf=0,item.expanded=!1,mydata.push(item)):$.each(e.cuentas,function(e,a){if(item={},item.id=a.id_cuenta,item["Código"]=a.id_cuenta,item.Cuenta=a.nombre_cuenta,item.Presupuesto_original=a.presupuesto,item.Presupuesto_original_2=a.presupuesto,item.Adendas=a.adendas,item.Presupuesto_total=a.presupuesto_total,item["%_de_Avance"]=a.porcentaje_avance,item["%_de_Avance_t"]=a.porcentaje_teorico,item.Presupuesto_por_avance=a.presupuestoxavance,item.Comp=toCurrency(a.comp),item.Gastado=toCurrency(a.gastado),item.Presupuesto_por_gastar=a.presupuestoxgastar,item.Costo_proyectado=a.costoproyectado,item.Diferencia_vs_Presupuesto=a.diferenciavspresupuesto,item.level=a.nivel,item.parent=a.id_padre,item.isLeaf=a.isleaf,item.expanded=!1,0==item.level&&(t_presupuesto_o+=item.Presupuesto_original,t_adendas+=item.Adendas,t_presupuesto_t+=item.Presupuesto_total,t_comp+=a.comp,t_gastado+=a.gastado,t_presupuesto_g+=item.Presupuesto_por_gastar),1===a.nivel){var o=a.id_cuenta.replace(a.id_padre,"");if(o=a.id_padre+o.substring(0,1)+"00.",o in cuentasDivisoras.cuentas&&t!==o){var s={};s.id=o,s["Código"]=o,s.Cuenta=cuentasDivisoras.cuentas[o],s.parent=a.id_padre,mydata.push(s)}t=o}mydata.push(item)}),$("#table_list_2").jqGrid({data:mydata,datatype:"local",height:600,autowidth:!0,shrinkToFit:!1,rowNum:10,rowList:[10,20,30],colNames:["id","Codigo","Cuenta","Presupuesto original","Adendas","Presupuesto total","Editar presupuesto original"],colModel:[{name:"id",editable:!1,index:"id",width:100,hidden:!0},{name:"Código",index:"Código",editable:!1,width:160,classes:"strong",align:"center"},{name:"Cuenta",index:"Cuenta",editable:!1,width:210,align:"left"},{name:"Presupuesto_original",editable:!1,width:180,align:"right",formatter:"currency",formatoptions:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,prefix:"$"}},{name:"Adendas",editable:!1,width:130,align:"right",formatter:"currency",formatoptions:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,prefix:"$"}},{name:"Presupuesto_total",editable:!1,width:150,align:"right",formatter:"currency",formatoptions:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,prefix:"$"}},{name:"Presupuesto_original_2",editable:!0,width:180,align:"right",formatter:"currency",formatoptions:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,prefix:"$"}}],pager:"#pager_list_2",viewrecords:!0,hidegrid:!1,scrollOffset:0,sortname:"id",treeGrid:!0,treeGridModel:"adjacency",treedatatype:"local",footerrow:!0,ExpandColumn:"Código",gridComplete:function(){$("#table_list_2_Presupuesto_original_2").css("background-color","yellow"),$("#table_list_2_Presupuesto_original_2").css("color","#000000");for(var e=$("#table_list_2"),t=e.jqGrid("getDataIDs"),a=0;a<t.length;a++){var o=t[a],s=e.jqGrid("getRowData",o).Cuenta,r=e.jqGrid("getRowData",o).id,i=r.substring(r.length-3,r.length);"00."==i&&(e.jqGrid("setRowData",o,!1,"myclass"),e.jqGrid("setRowData",o,{Cuenta:s,Presupuesto_original:"-",Adendas:"-",Presupuesto_total:"-","%_de_Avance":"-","%_de_Avance_t":"-",Presupuesto_por_avance:"-",Comp:"-",Gastado:"-",Presupuesto_por_gastar:"-",Costo_proyectado:"-",Diferencia_vs_Presupuesto:"-"}))}},saveRow:function(e,t,a,o,s){},onSelectRow:function(e){var t=$("#table_list_2");if(e&&e!==lastSel){t.jqGrid("restoreRow",lastSel);var a=t.jqGrid("getColProp","Name"),o=t.jqGrid("getRowData",e);if("true"===o.isLeaf){a.editable=!1;var s={keys:!0,oneditfunc:null,successfunc:null,url:subfolder+"/guardarEdit",extraparam:{_token:$("input[name=_token]").val(),id_centro:$("#idCentro").val()},aftersavefunc:function(e,t){},errorfunc:null,afterrestorefunc:null,restoreAfterError:!0,mtype:"POST"};t.jqGrid("editRow",e,s),a.editable=!0}lastSel=e}}}),$("#table_list_2_Presupuesto_original").append("<h6>Total: "+toCurrency(t_presupuesto_o)+"</h6>"),$("#table_list_2_Adendas").append("<h6>Total: "+toCurrency(t_adendas)+"</h6>"),$("#table_list_2_Presupuesto_total").append("<h6>Total: "+toCurrency(t_presupuesto_t)+"</h6>"),$("#table_list_2_Comp").append("<h6>Total: "+toCurrency(t_comp)+"</h6>"),$("#table_list_2_Gastado").append("<h6>Total: "+toCurrency(t_gastado)+"</h6>"),$("#table_list_2_Presupuesto_por_gastar").append("<h6>Total: "+toCurrency(t_presupuesto_g)+"</h6>"),$.jgrid.formatter.currency.decimalSeparator=".",$.jgrid.formatter.currency.thousandsSeparator=",",$.jgrid.formatter.currency.decimalPlaces="2",$(window).bind("resize",function(){var e=$(".jqGrid_wrapper").width();$("#table_list_2").setGridWidth(e)}),$("#table_list_2")[0].addJSONData({total:1,page:1,records:mydata.length,rows:mydata}),$("#table_list_2").navGrid("#pager_list_2",{edit:!1,add:!1,del:!1,search:!1,refresh:!1}).navButtonAdd("#pager_list_2",{caption:"Expandir / Contraer Todo",onClickButton:function(){$("#table_list_2").find(".treeclick").trigger("click")},position:"last",title:"Expandir / Contraer Todo",cursor:"pointer"}),$("#table_list_2 tbody .jqgrow").each(function(e){"none"!=$(this).css("display")&&$(this).children("td:nth-child(3)").addClass("strong"),mydata[e].Diferencia_vs_Presupuesto<0?$(this).children("td:nth-child(13)").css("color","red"):$(this).children("td:nth-child(13)").css("color","green")}),$("#table_list_2").jqGrid("footerData","set",{Cuenta:"TOTALES:",Presupuesto_original:t_presupuesto_o,Adendas:t_adendas,Presupuesto_total:t_presupuesto_t,Comp:toCurrency(t_comp),Gastado:toCurrency(t_gastado),Presupuesto_por_gastar:t_presupuesto_g}),$(".footrow").find("a").removeAttr("href").css("cursor","default").css("color","white").css("textDecoration","none"),$("#modalCargando").modal("hide")}})}),$(function(){$("select").multipleSelect({selectAll:!1,countSelected:"# elementos seleccionados",minimumCountSelected:6,placeholder:"Seleccione las cuentas a agregar"})});