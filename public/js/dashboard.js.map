{"version":3,"sources":["dashboard.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"dashboard.js","sourcesContent":["Array.prototype.removeValue = function(name, value){\n    var array = $.map(this, function(v,i){\n        return v[name] === value ? null : v;\n    });\n    this.length = 0; //clear original array\n    this.push.apply(this, array); //push all elements except the one we want to delete\n}\n\n$(document).ready(function () {\n\n    $(\"#modalCargando\").modal();    \n    $('#data_1 .input-group.date').datepicker({\n        todayBtn: \"linked\",\n        keyboardNavigation: false,\n        forceParse: false,\n        autoclose: true\n    });\n    var mydata = []; \n    var  token, url, data;\n    token = $('input[name=_token]').val();\n\n    var anticipopagos, estadop, inactivos, docp;\n\n    $.ajax({\n        url: subfolder + '/centros',\n        headers: {'X-CSRF-TOKEN': token},\n        type: 'GET',\n        datatype: 'JSON',\n        success: function (resp) {\n            anticipopagos =resp.anticipopagos;\n            estadop =resp.estadop;\n            docp =resp.docp;\n            var presupuestoxgastar = parseInt(resp.presupuestoxgastar);\n            $('#modalCargando').modal('hide');\n            $.each(resp.centros, function (key, value) {\n                selColModel = value.colmodel;\n                item = {};\n                item [\"id\"] = value.id_centro;\n                item [\"NoProyecto\"] = value.nombre;\n                item [\"centro\"] = value.nombre_centro;\n                item [\"contratante\"] = value.contratante;\n                item [\"tel_contratante\"] = value.tel_contratante;\n                item [\"monto_contratado\"] = value.monto_contratado;\n                item [\"tipo\"] = value.tipo;\n                item [\"presupuesto_original\"] = value.presupuesto;\n                item [\"monto_adendas\"] = value.adendas;\n                item [\"presupuesto_total\"] = parseFloat(value.presupuesto)+parseFloat(value.adendas);\n                if(!parseFloat(value.adendas))\n                    item [\"presupuesto_total\"] = parseFloat(value.presupuesto); \n                item [\"%_de_Avance\"] = value.porcentaje_avance;  \n                //                item [\"%_de_Avance_t\"] = value.porcentaje_teorico;  \n                item [\"gastado\"] = value.gastado; \n                var valpresupuestoxgastar = 0;\n                    if(presupuestoxgastar === 1){\n                        valpresupuestoxgastar = (parseFloat(value.presupuesto)+parseFloat(value.adendas)) - value.gastado; \n                    } else if(presupuestoxgastar === 2){\n                        valpresupuestoxgastar = (parseFloat(value.presupuesto)+parseFloat(value.adendas)) - (value.gastado+value.comp); \n                    }\n                item [\"presupuestoxgastar\"] = valpresupuestoxgastar;\n\n\n                item [\"anticipos_por_amortizar\"] = value.anticipos_por_amortizar;                \n                item [\"pagado\"] = value.pagado;\n\n                item [\"comprometido\"]=value.comp;\n\n                item [\"facturado\"] = value.facturado;\n                item [\"cobrado\"] = value.cobrado;\n                item [\"update\"] = value.ultima_actualizacion;\n                item [\"level\"] = value.nivel;\n                item [\"parent\"] = value.id_padre;\n                if(value.id_padre==0)\n                    item [\"parent\"]=null;\n                item [\"isLeaf\"] = value.isleaf;\n                item [\"expanded\"] = false;\n                item [\"estado\"] = value.estado;\n                item [\"documentacion\"] = value.documentacion;\n\n                \n\n\n                mydata.push(item);\n            });\n\n\n            var colmodel = [\n                {name: 'id', index: 'id', width: 100, hidden:true},\n                {name: 'NoProyecto', index: 'noproyecto', width: 100, sortable: true, align: 'center',formatter:'showlink', formatoptions:{baseLinkUrl:subfolder +'/details', idName:'idCentro'}},\n                //{name: 'centro', index: 'centro', width: 340, sortable: true, align: 'left',formatter:'showlink', formatoptions:{baseLinkUrl:subfolder +'/details', idName:'idCentro'}},\n                {name: 'centro', index: 'centro', width: 340, sortable: true, align: 'left'},\n                {name: 'contratante', index: 'contratante', width: 180, sortable: true, align: 'center'},\n                // {name: 'tel_contratante', index: 'tel_contratante', width: 160, sortable: false, align: 'center'},\n                {name: 'tipo', index: 'tipo', width: 120, sortable: false, align: 'center'},\n                {name: 'presupuesto_original', index: 'presupuesto_original', width: 180, formatter:'currency', formatoptions:{decimalSeparator:\".\", thousandsSeparator: \",\", decimalPlaces: 2, prefix: \"$\"}, sorttype: \"float\", align: 'right'},\n                {name: 'monto_adendas', index: 'monto_adendas', width: 100, formatter:'currency', formatoptions:{decimalSeparator:\".\", thousandsSeparator: \",\", decimalPlaces: 2, prefix: \"$\"}, sorttype: \"float\", align: 'right'},\n                {name: 'presupuesto_total', index: 'presupuesto_total', width: 150, formatter:'currency', formatoptions:{decimalSeparator:\".\", thousandsSeparator: \",\", decimalPlaces: 2, prefix: \"$\"}, sorttype: \"float\", align: 'right'},\n                {name: '%_de_Avance', width: 120, sorttype: \"float\", align: 'center', formatter:'currency', formatoptions:{thousandsSeparator: \",\", decimalPlaces: 2, suffix: \"%\"}},\n                /*\n                    {name: '%_de_Avance_t', width: 150, sorttype: \"float\", align: 'center', formatter:'currency', formatoptions:{thousandsSeparator: \",\", decimalPlaces: 2, suffix: \"%\"}},\n                    */\n                {name: 'comprometido', index: 'comprometido', width: 120, formatter:'currency', formatoptions:{decimalSeparator:\".\", thousandsSeparator: \",\", decimalPlaces: 2, prefix: \"$\"}, sorttype: \"float\", align: 'right'},\n                {name: 'gastado', index: 'gastado', width: 120, formatter:'currency', formatoptions:{decimalSeparator:\".\", thousandsSeparator: \",\", decimalPlaces: 2, prefix: \"$\"}, sorttype: \"float\", align: 'right'},\n                {name: 'pagado', index: 'pagado', width: 120, formatter:'currency', formatoptions:{decimalSeparator:\".\", thousandsSeparator: \",\", decimalPlaces: 2, prefix: \"$\"}, sorttype: \"float\", align: 'right'},\n                {name: 'presupuestoxgastar', index: 'presupuestoxgastar', width: 100, formatter:'currency', formatoptions:{decimalSeparator:\".\", thousandsSeparator: \",\", decimalPlaces: 2, prefix: \"$\"}, sorttype: \"float\", align: 'right'},\n                {name: 'anticipos_por_amortizar', index: 'anticipos_por_amortizar', width: 170, formatter:'currency', formatoptions:{decimalSeparator:\".\", thousandsSeparator: \",\", decimalPlaces: 2, prefix: \"$\"}, sorttype: \"float\", align: 'right'},\n                {name: 'facturado', index: 'facturado', width: 90, formatter:'currency', formatoptions:{decimalSeparator:\".\", thousandsSeparator: \",\", decimalPlaces: 2, prefix: \"$\"}, sorttype: \"float\", align: 'right'},\n                {name: 'cobrado', index: 'cobrado', width: 90, formatter:'currency', formatoptions:{decimalSeparator:\".\", thousandsSeparator: \",\", decimalPlaces: 2, prefix: \"$\"}, sorttype: \"float\", align: 'right'},                   \n                {name: 'update', index: 'update', width: 170, sortable: false, formatter: \"date\", formatoptions : {srcformat : 'Y-m-d H:i',newformat : 'd-m-Y H:i'},align: 'center'},\n                {name: 'documentacion', index: 'documentacion', width: 120, sortable: false, align: 'center',formatter:'showlink', formatoptions:{baseLinkUrl:subfolder +'/documentos', idName:'idCentro'}},\n                {name: 'estado', index: 'estado', width: 120, sortable: false, align: 'center',\n                 cellattr: function(rowId, val, rawObject) {\n                     if (val ===\"Activo\") {\n                         return 'style=\"background-color:#9ACD32;border-radius:10px;\"';\n                     }\n                     if (val ===\"En Revisión\") {\n                         return 'style=\"background-color:#FFA500;border-radius:10px;\"';\n                     }\n                     if (val ===\"Inactivo\") {\n                         return 'style=\"background-color:#A9A9A9;border-radius:10px;\"';\n                     }\n                     if (val ===\"Suspendido\") {\n                         return 'style=\"background-color:#FF0000;border-radius:10px;\"';\n                     }\n                 }},\n                {name: 'name', index: 'name', width: 90, sortable: false, align: 'center'}\n            ];\n\n            var colnames = ['id','No. De proyecto','Centro Contable', 'PM', /* 'Tel. del PM', */ 'Tipo', 'Presupuesto Original', 'Adendas', 'Presupuesto Total', '% de avance',/*'% de avance Teorico',*/ 'Comprometido', 'Gastado', 'Desembolsado', 'Presupuesto por gastar', 'Anticipos por Amortizar', 'Facturado', 'Cobrado', 'Última Actualización','Documentacion','Estado', ''];\n\n\n            if(!anticipopagos){    \n                colmodel.removeValue('name','anticipos_por_amortizar')\n                colmodel.removeValue('name','pagado')\n\n                var index = colnames.indexOf(\"Anticipos por Amortizar\");\n                if (index > -1) {\n                    colnames.splice(index, 1);\n                }\n                index = colnames.indexOf(\"Desembolsado\");\n                if (index > -1) {\n                    colnames.splice(index, 1);\n                }\n            }\n            if(!estadop){    \n                colmodel.removeValue('name','estado')\n                var index = colnames.indexOf(\"Estado\");\n                if (index > -1) {\n                    colnames.splice(index, 1);\n                }\n            }\n\n            if(!docp){    \n                colmodel.removeValue('name','documentacion')\n                var index = colnames.indexOf(\"Documentacion\");\n                if (index > -1) {\n                    colnames.splice(index, 1);\n                }\n            }\n\n            \n            $(\"#table_list_1\").jqGrid({\n                regional : 'en',\n                data: mydata,\n                datatype: \"local\",\n                height: 700,\n                autowidth: true,\n                shrinkToFit: false,\n                rowNum: 10,\n                rowList: [10, 20, 30],\n                colNames: colnames,\n                colModel: colmodel,\n                pager: \"#pager_list_1\",\n                viewrecords: true,\n                gridComplete: function() {\n                    var grid = $(\"#table_list_1\");\n                    console.log(grid);\n                    var ids = grid.jqGrid('getDataIDs');\n                    //var ids = grid.jqGrid('getDataCentros');\n                    for (var i = 0; i < ids.length; i++) {\n                        var rowId = ids[i];\n                        var checkOut = '<a data-toggle=\"modal\" class=\"btn-primary btn-sm\" style=\"color:white;\" onclick=\"loadModal('+rowId+')\">Opciones</a>';\n                        var centroLink1 = '<a data-toggle=\"modal\" class=\"\" onclick=\"centroContableModal('+rowId+')\">'; \n                        var centroLink2 = '</a>';           \n                        if(grid.jqGrid('getRowData',rowId).isLeaf=='true'){ // only add options to \n                            grid.jqGrid('setRowData', rowId, { name: checkOut });\n                            var mycentro = grid.jqGrid('getRowData',rowId).centro;\n                            grid.jqGrid('setRowData', rowId, { centro: centroLink1+mycentro+centroLink2 },{background:'white'});\n                        }\n                        else\n                            grid.jqGrid('setRowData', rowId, { estado:'' },{background:'white'});\n                        \n                    }\n                },\n                hidegrid: false,\n                scrollOffset: 0,\n                sortname: 'id',\n                treeGrid: true,\n                treeGridModel: 'adjacency',\n                treedatatype: \"local\",\n                ExpandColumn: 'centro',\n                gridview: true\n            });\n            $.jgrid.formatter.currency.decimalSeparator='.';\n            $.jgrid.formatter.currency.thousandsSeparator=',';\n            $.jgrid.formatter.currency.decimalPlaces='2';\n            //Add responsive to jqGrid\n            $(window).bind('resize', function () {\n                var width = $('.jqGrid_wrapper').width();\n                $('#table_list_1').setGridWidth(width);\n            });\n            $(\"#table_list_1\")[0].addJSONData({\n                total: 1,\n                page: 1,\n                records: mydata.length,\n                rows: mydata\n            });\n            $(\"#table_list_1\")\n                .navGrid('#pager_list_1',{edit:false,add:false,del:false,search:false,refresh:false})\n                .navButtonAdd('#pager_list_1',{\n                caption: \"Expandir / Contraer Todo\",\n                onClickButton: function() {\n                    $(\"#table_list_1\").find(\".treeclick\").trigger('click');\n                },\n                position: \"last\",\n                title: \"Expandir / Contraer Todo\",\n                cursor: \"pointer\"\n            });\n            $(\"#table_list_1 tbody .jqgrow\").each(function (index){\n                if(!(mydata[index]['isLeaf'])) // remove link to totalizadores \n                    $(this).find(\"a\").removeAttr(\"href\").css(\"cursor\",\"default\").css('color', 'black').css('textDecoration','none');\n            });\n            if($('#verFacturasCobros').val()!=1){ // hide facturado and cobrado to users no allowed\n                $(\"#table_list_1\").jqGrid('hideCol',[\"facturado\"]);\n                $(\"#table_list_1\").jqGrid('hideCol',[\"cobrado\"]);        \n            }        \n        }\n    });\n});\n\nfunction reload(action){\n    if(action == 'clear'){\n        $('#textFilter').val('');\n        $('#dateFilter').val('');\n    }\n    $(\"#modalCargando\").modal();\n    var mydata = [];\n    var token = $('input[name=_token]').val();\n    filterText = $('#textFilter').val();\n    filterText2 = $('#dateFilter').val();\n    $.ajax({\n        url: subfolder + '/centros',\n        headers: {'X-CSRF-TOKEN': token},\n        type: 'GET',\n        data: {'textFilter':filterText,'dateFilter':filterText2,'search':1} ,\n        datatype: 'JSON',\n        success: function (resp) {\n            $('#modalCargando').modal('hide');\n            if(resp.centros != null){\n                var presupuestoxgastar = parseInt(resp.presupuestoxgastar);\n                \n                $.each(resp.centros, function (key, value) {\n                    selColModel = value.colmodel;\n\n                    item = {}\n                    item [\"id\"] = value.id_centro;\n                    item [\"NoProyecto\"] = value.nombre;\n                    item [\"centro\"] = value.nombre_centro;\n                    item [\"contratante\"] = value.contratante;\n                    item [\"tel_contratante\"] = value.tel_contratante;\n                    item [\"tipo\"] = value.tipo;\n                    item [\"presupuesto_original\"] = value.presupuesto;\n                    item [\"monto_adendas\"] = value.adendas;\n                    item [\"presupuesto_total\"] = parseFloat(value.presupuesto)+parseFloat(value.adendas);\n                    if(!parseFloat(value.adendas))\n                        item [\"presupuesto_total\"] = parseFloat(value.presupuesto);\n                    item [\"%_de_Avance\"] = value.porcentaje_avance;\n                    //                    item [\"%_de_Avance_t\"] = value.porcentaje_teorico;\n                    item [\"gastado\"] = value.gastado;\n                    var valpresupuestoxgastar = 0;\n                    if(presupuestoxgastar === 1){\n                        valpresupuestoxgastar = (parseFloat(value.presupuesto)+parseFloat(value.adendas)) - value.gastado; \n                    } else if(presupuestoxgastar === 2){\n                        valpresupuestoxgastar = (parseFloat(value.presupuesto)+parseFloat(value.adendas)) - (value.gastado+value.comp); \n                    }\n                    item [\"presupuestoxgastar\"] = valpresupuestoxgastar;\n                    item [\"anticipos_por_amortizar\"] = value.anticipos_por_amortizar;                \n                    item [\"pagado\"] = value.pagado;\n\n\n                    item [\"facturado\"] = value.facturado;\n                    item [\"cobrado\"] = value.cobrado;\n                    item [\"update\"] = value.ultima_actualizacion;\n                    item [\"level\"] = value.nivel;\n                    item [\"parent\"] = value.id_padre;\n                    if(value.id_padre==0)\n                        item [\"parent\"]=null;\n                    item [\"isLeaf\"] = value.isleaf;\n                    item [\"expanded\"] = false;\n                    item [\"estado\"] = value.estado;\n                    item [\"documentacion\"] = value.documentacion;\n\n                    anticipopagos =value.anticipopagos;\n                    estadop =value.estadop;\n                    docp =value.docp;\n                    item [\"expanded\"] = false;\n                    mydata.push(item);\n\n                });\n            }\n            if (mydata === undefined || mydata.length == 0) {\n                setTimeout(function() {\n                    toastr.options = {\n                        closeButton: true,\n                        progressBar: false,\n                        positionClass: \"toast-top-center\",\n                        showMethod: 'slideDown',\n                        timeOut: 4000\n                    };\n                    toastr.success('No se encontraron registros');\n                }, 1300);\n                jQuery('#table_list_1').jqGrid('clearGridData').trigger('reloadGrid');\n            }else{\n                setTimeout(function() {\n                    toastr.options = {\n                        closeButton: true,\n                        progressBar: false,\n                        positionClass: \"toast-top-center\",\n                        showMethod: 'slideDown',\n                        timeOut: 4000\n                    };\n                    if(mydata.length==1)\n                        toastr.success(resp.centros.length +' Registro encontrado');\n                    if(mydata.length>1)\n                        toastr.success(resp.centros.length +' Registros encontrados');\n                }, 1300);\n                $(\"#table_list_1\")[0].addJSONData({\n                    total: 1,\n                    page: 1,\n                    records: mydata.length,\n                    rows: mydata\n                });\n                $(\"#table_list_1 tbody .jqgrow\").each(function (index){\n                    if(!(mydata[index]['isLeaf'])) // remove link to totalizadores \n                        $(this).find(\"a\").removeAttr(\"href\").css(\"cursor\",\"default\").css('color', 'black').css('textDecoration','none');\n                });\n                if($('#verFacturasCobros').val()!=1){ // hide facturado and cobrado to users no allowed\n                    $(\"#table_list_1\").jqGrid('hideCol',[\"facturado\"]);\n                    $(\"#table_list_1\").jqGrid('hideCol',[\"cobrado\"]);        \n                }\n            }\n        }\n    });\n}\n\nfunction loadModal(rowId){\n    var nameProject = jQuery('#table_list_1').jqGrid ('getCell', rowId, 'note');\n    $('#nameProject').html('');\n    $('#nameProject').append(nameProject);\n    $(\"#detailsLinkModal\").attr(\"href\", subfolder +\"/details?idCentro=\"+rowId);\n    $(\"#presupuestoManual\").attr(\"href\", subfolder +\"/details-edit?idCentro=\"+rowId);\n    $(\"#graficoLinkModal\").attr(\"href\", subfolder +\"/grafico?idCentro=\"+rowId);\n    //$(\"#graficoMLinkModal\").attr(\"href\", subfolder +\"/grafico_test\");\n    $(\"#gastadoLinkModal\").attr(\"href\", subfolder +\"/gastado?idCentro=\"+rowId);\n    $(\"#updateLinkModal\").attr(\"href\", subfolder +\"/update?idCentro=\"+rowId);\n    $(\"#adendaLinkModal\").attr(\"href\", subfolder +\"/adenda_crear?idCentro=\"+rowId);\n    $(\"#bitacoraLinkModal\").attr(\"href\", subfolder +\"/bitacora?idCentro=\"+rowId);\n    $(\"#updateDetailsLinkModal\").attr(\"href\", subfolder +\"/update_details?idCentro=\"+rowId);\n    $(\"#updateEstadoProyecto\").attr(\"href\", subfolder +\"/cambiarestado?idCentro=\"+rowId);\n    $(\"#documentosProyecto\").attr(\"href\", $(\"#documentosProyecto\").attr(\"href\")+\"?idCentro=\"+rowId);\n    $(\"#modal-form\").modal();\n}\n\nfunction centroContableModal(rowId){\n\n    $(\"#detailsFinanciera\").attr(\"href\", subfolder +\"/details?idCentro=\"+rowId);\n    $(\"#detailsConsumo\").attr(\"href\", subfolder +\"/presupuestoitems?idCentro=\"+rowId);\n    $(\"#modal-form-centros\").modal();\n}\n\n\n\n\n\n"]}