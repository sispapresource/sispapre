{"version":3,"sources":["item_crear.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"item_crear.js","sourcesContent":["var mydata = [];\nvar updates = [];\nvar last = 'tablesd';\n\n$(document).ready(function () {\n    $(\"#modalCargando\").modal();\n    var token = $('input[name=_token]').val();\n\n    populateSelect(\"\");\n\n    $(\"#select-tablesd\").combobox({ \n        select: function (event, ui) { \n            $(\"#select-tablesd\").trigger('change');\n        } \n    });\n\n    function populateSelect(filter){\n        $.ajax({\n            url: subfolder +'/cuentasu',\n            headers: {'X-CSRF-TOKEN': token,cuentaFilter:filter},\n            type: 'GET',\n            datatype: 'JSON',\n            data: {'nivel':2} ,\n            success: function (resp) {\n                $.each(resp.cuentas, function (key, value) {\n                    item = {}\n                    item [\"id\"] = value.id_cuenta;\n                    item [\"cuenta\"] = value.nombre_cuenta;\n                    item [\"name\"] = value.presupuesto;\n                    item [\"show\"] = 1;\n                    mydata.push(item);\n                    $(\"#select-tablesd\").append('<option value=\"'+value.id_cuenta+'_'+value.presupuesto+'_'+key+'\">'+value.id_cuenta+' '+value.nombre_cuenta+'</option>');\n                });\n                $('#modalCargando').modal('hide');\n            }\n        });\n    }\n    //    $(\"#select-tablesd\").keyup(function(){\n    //        $(\"#select-tablesd\").find('option').remove();\n    //    });\n\n});\n\n\n\n$(\"#add\").click(function(){\n    $(\"#buttonDelete\"+last).show();\n    var valor1 = Math.floor(Math.random() * 10000);\n    $(\"#adendas\").append('<div class=\"row divDetail\" id=\"div'+valor1+'\"><div class=\"form-group col-sm-3\"><label for=\"inputCuenta\" class=\"btn-block\">Cuenta</label><select name=\"select\" class=\"form-control\" id=\"select-table'+valor1+'\"></select></div><div class=\"form-group col-sm-3\" id=\"data_1\"><label for=\"inputActualizacion\" class=\"btn-block\">Monto actual</label><div class=\"input-group\" id=\"inputActualizacion\" ><span class=\"usd-off input-group-addon \"><i class=\"fa fa-usd\"></i></span><input class=\"form-control amountOld\" type=\"text\" disabled=\"disabled\" id=\"select-table'+valor1+'amountOld\"></div></div><div class=\"col-sm-3 form-group\"> <label for=\"inputCuenta\" class=\"btn-block\">Costo</label><div class=\"input-group date\" id=\"inputActualizacion\" ><span class=\"input-group-addon\"><i class=\"fa fa-usd\"></i></span><input class=\"form-control amountNew\" type=\"text\" id=\"select-table'+valor1+'amountNew\"></div></div><div class=\"col-sm-3 button-top\"><button type=\"button\" class=\"btn btn-gray\" id=\"buttonDeletetable'+valor1+'\" style=\"display:none;\" onclick=\"deleteDiv('+valor1+')\"><i class=\"fa fa-trash-o\" title=\"Delete\"></i></button></div></div>');\n    $.each(mydata, function (key, value) {\n        $(\"#select-table\"+valor1).append('<option value=\"'+mydata[key][\"id\"]+'_'+mydata[key][\"name\"]+'_'+key+'\">'+mydata[key][\"id\"]+' '+mydata[key][\"cuenta\"]+'</option>');\n        $(\"#select-table\"+valor1).addClass('select-table');\n    });\n    last=\"table\"+valor1;\n    $(\"#select-table\"+valor1).combobox({ \n        select: function (event, ui) { \n            $(\"#select-table\"+valor1).trigger('change'); // add function change to news select\n        } \n    });\n    $(\"#select-table\"+valor1).trigger('change');\n});\n\n$(\"#adendas\").on(\"change\", \".select-table\", function(){\n    $(\"#divAdenda\").show();\t\n    $(\"#divamountOld\").show();\n    $(\".btn-add\").show();\n    $(\"#\"+$(this).attr(\"id\")+\"amountOld\").val($(this).val().split('_')[1]);\n});\n\n$(\"#adendas\").on(\"keypress\", \".amountNew\", function(e){\n    if (e.which != 45 && e.which != 8 && e.which != 0 && e.which != 46 && (e.which < 48 || e.which > 57)) // -, retroceso, nulo, punto, numeros\n        return false; \n});\n\n$(\"#adendas\").on(\"keyup\", \".amountNew\", function(){\n    reloadAmountAdenda();    \n});\n\nfunction reloadAmountAdenda() {\n    var totalOld = totalNew = 0;\n    $(\".amountNew\").each(function (index){ \n        if($(this).val().trim().length > 0)\n            totalNew+=parseFloat($(this).val());\n    }); \n    $(\".amountOld\").each(function (index){ \n        if($(this).val().trim().length > 0)\n            totalOld+=parseFloat($(this).val());\n    });\n    \n    var res = (totalNew).toFixed(2)+\"\";\n    if(res === '-0.00'){\n        res = '0.00';\n    }\n    $('#amountAdenda').val(res);\n};\n\nfunction deleteDiv(id) {\n    var exist=0;\n    $(\".select-table\").each(function (index){ \n        exist+=1;\n    });\n    if(exist>1){\n        mydata[$(\"#select-table\"+id+\"\").val().split('_')[2]][\"show\"]=1;\n        $(\"#select-\"+last).empty();\n        $.each(mydata, function (key, value){\n            if(mydata[key][\"show\"]==1)\n                $(\"#select-\"+last).append('<option value=\"'+mydata[key][\"id\"]+'_'+mydata[key][\"name\"]+'_'+key+'\">'+mydata[key][\"id\"]+' '+mydata[key][\"cuenta\"]+'</option>');\n        });\n        $(\"#div\"+id).remove();\n        reloadAmountAdenda();\n    }\n};\n\nfunction save(idAjuste){\n    var updates=[];\n    var jsonString, item_a;\n    $(\".divDetail\").each(function (index){ \n        if($(this).find(\".form-group .input-group .amountNew\").val().trim().length > 0){\n            item_a = {\n                id_cuenta: $(this).find(\".form-group .select-table\").val().split('_')[0],\n                monto_anterior: $(this).find(\".form-group .select-table\").val().split('_')[1],\n                monto_nuevo: parseFloat($(this).find(\".form-group .input-group .amountNew\").val())\n            };\n            updates.push(item_a);        \n        }\n    }); \n    jsonString = JSON.stringify(updates);\n    var token = $('input[name=_token]').val();\n    $(\"#button-save\").prop('disabled', true);\n    $.ajax({\n        url: subfolder +'/item_guardar',\n        headers: {'X-CSRF-TOKEN': token},\n        type: 'GET',\n        data:  {idAjuste:idAjuste,nro_item:$('#nro_item').val(),observaciones:$('#observaciones').val(),monto:$('#amountAdenda').val(),amounts:jsonString},\n        success:  function(response){\n            if(response['response']==\"success\"){\n                setTimeout(function(){\n                    toastr.options = {\n                        closeButton: true,\n                        progressBar: false,\n                        positionClass: \"toast-top-center\",\n                        showMethod: 'slideDown',\n                        timeOut: 4000\n                    };\n                    toastr.success('Item Creado con Exito');\n                }, 1300);\n                setTimeout(function(){\n                    window.location=subfolder+\"/ajuste_detail?idAjuste=\"+idAjuste;\n                }, 2600);    \n            }\n            else{\n                setTimeout(function(){\n                    toastr.options = {\n                        closeButton: true,\n                        progressBar: false,\n                        positionClass: \"toast-top-center\",\n                        showMethod: 'slideDown',\n                        timeOut: 4000\n                    };\n                    toastr.error('Creacion de Item Fallida');\n                }, 1300);\n                setTimeout(function(){\n                    window.location=subfolder+\"/ajuste_detail?idAjuste=\"+idAjuste;\n                }, 2600);\n            }\n        }\n    });\n};\n\n"]}