function reload(t){"clear"==t&&($("#textFilter").val(""),$("#dateFilter").val("")),$("#modalCargando").modal();var e=[],a=$("input[name=_token]").val();filterText=$("#textFilter").val(),filterText2=$("#dateFilter").val(),$.ajax({url:subfolder+"/centros",headers:{"X-CSRF-TOKEN":a},type:"GET",data:{textFilter:filterText,dateFilter:filterText2,search:1},datatype:"JSON",success:function(t){if($("#modalCargando").modal("hide"),null!=t.centros){var a=parseInt(t.presupuestoxgastar);$.each(t.centros,function(t,o){selColModel=o.colmodel,item={},item.id=o.id_centro,item.NoProyecto=o.nombre,item.centro=o.nombre_centro,item.contratante=o.contratante,item.tel_contratante=o.tel_contratante,item.tipo=o.tipo,item.presupuesto_original=o.presupuesto,item.monto_adendas=o.adendas,item.presupuesto_total=parseFloat(o.presupuesto)+parseFloat(o.adendas),parseFloat(o.adendas)||(item.presupuesto_total=parseFloat(o.presupuesto)),item["%_de_Avance"]=o.porcentaje_avance,item.gastado=o.gastado;var r=0;1===a?r=parseFloat(o.presupuesto)+parseFloat(o.adendas)-o.gastado:2===a&&(r=parseFloat(o.presupuesto)+parseFloat(o.adendas)-(o.gastado+o.comp)),item.presupuestoxgastar=r,item.anticipos_por_amortizar=o.anticipos_por_amortizar,item.pagado=o.pagado,item.facturado=o.facturado,item.cobrado=o.cobrado,item.update=o.ultima_actualizacion,item.level=o.nivel,item.parent=o.id_padre,0==o.id_padre&&(item.parent=null),item.isLeaf=o.isleaf,item.expanded=!1,item.estado=o.estado,item.documentacion=o.documentacion,anticipopagos=o.anticipopagos,estadop=o.estadop,docp=o.docp,item.expanded=!1,e.push(item)})}void 0===e||0==e.length?(setTimeout(function(){toastr.options={closeButton:!0,progressBar:!1,positionClass:"toast-top-center",showMethod:"slideDown",timeOut:4e3},toastr.success("No se encontraron registros")},1300),jQuery("#table_list_1").jqGrid("clearGridData").trigger("reloadGrid")):(setTimeout(function(){toastr.options={closeButton:!0,progressBar:!1,positionClass:"toast-top-center",showMethod:"slideDown",timeOut:4e3},1==e.length&&toastr.success(t.centros.length+" Registro encontrado"),e.length>1&&toastr.success(t.centros.length+" Registros encontrados")},1300),$("#table_list_1")[0].addJSONData({total:1,page:1,records:e.length,rows:e}),$("#table_list_1 tbody .jqgrow").each(function(t){e[t].isLeaf||$(this).find("a").removeAttr("href").css("cursor","default").css("color","black").css("textDecoration","none")}),1!=$("#verFacturasCobros").val()&&($("#table_list_1").jqGrid("hideCol",["facturado"]),$("#table_list_1").jqGrid("hideCol",["cobrado"])))}})}function loadModal(t){var e=jQuery("#table_list_1").jqGrid("getCell",t,"note");$("#nameProject").html(""),$("#nameProject").append(e),$("#detailsLinkModal").attr("href",subfolder+"/details?idCentro="+t),$("#presupuestoManual").attr("href",subfolder+"/details-edit?idCentro="+t),$("#graficoLinkModal").attr("href",subfolder+"/grafico?idCentro="+t),$("#gastadoLinkModal").attr("href",subfolder+"/gastado?idCentro="+t),$("#updateLinkModal").attr("href",subfolder+"/update?idCentro="+t),$("#adendaLinkModal").attr("href",subfolder+"/adenda_crear?idCentro="+t),$("#bitacoraLinkModal").attr("href",subfolder+"/bitacora?idCentro="+t),$("#updateDetailsLinkModal").attr("href",subfolder+"/update_details?idCentro="+t),$("#updateEstadoProyecto").attr("href",subfolder+"/cambiarestado?idCentro="+t),$("#documentosProyecto").attr("href",$("#documentosProyecto").attr("href")+"?idCentro="+t),$("#modal-form").modal()}function centroContableModal(t){$("#detailsFinanciera").attr("href",subfolder+"/details?idCentro="+t),$("#detailsConsumo").attr("href",subfolder+"/presupuestoitems?idCentro="+t),$("#modal-form-centros").modal()}Array.prototype.removeValue=function(t,e){var a=$.map(this,function(a,o){return a[t]===e?null:a});this.length=0,this.push.apply(this,a)},$(document).ready(function(){$("#modalCargando").modal(),$("#data_1 .input-group.date").datepicker({todayBtn:"linked",keyboardNavigation:!1,forceParse:!1,autoclose:!0});var t,e=[];t=$("input[name=_token]").val();var a,o,r;$.ajax({url:subfolder+"/centros",headers:{"X-CSRF-TOKEN":t},type:"GET",datatype:"JSON",success:function(t){a=t.anticipopagos,o=t.estadop,r=t.docp;var i=parseInt(t.presupuestoxgastar);$("#modalCargando").modal("hide"),$.each(t.centros,function(t,a){selColModel=a.colmodel,item={},item.id=a.id_centro,item.NoProyecto=a.nombre,item.centro=a.nombre_centro,item.contratante=a.contratante,item.tel_contratante=a.tel_contratante,item.monto_contratado=a.monto_contratado,item.tipo=a.tipo,item.presupuesto_original=a.presupuesto,item.monto_adendas=a.adendas,item.presupuesto_total=parseFloat(a.presupuesto)+parseFloat(a.adendas),parseFloat(a.adendas)||(item.presupuesto_total=parseFloat(a.presupuesto)),item["%_de_Avance"]=a.porcentaje_avance,item.gastado=a.gastado;var o=0;1===i?o=parseFloat(a.presupuesto)+parseFloat(a.adendas)-a.gastado:2===i&&(o=parseFloat(a.presupuesto)+parseFloat(a.adendas)-(a.gastado+a.comp)),item.presupuestoxgastar=o,item.anticipos_por_amortizar=a.anticipos_por_amortizar,item.pagado=a.pagado,item.comprometido=a.comp,item.facturado=a.facturado,item.cobrado=a.cobrado,item.update=a.ultima_actualizacion,item.level=a.nivel,item.parent=a.id_padre,0==a.id_padre&&(item.parent=null),item.isLeaf=a.isleaf,item.expanded=!1,item.estado=a.estado,item.documentacion=a.documentacion,e.push(item)});var d=[{name:"id",index:"id",width:100,hidden:!0},{name:"NoProyecto",index:"noproyecto",width:100,sortable:!0,align:"center",formatter:"showlink",formatoptions:{baseLinkUrl:subfolder+"/details",idName:"idCentro"}},{name:"centro",index:"centro",width:340,sortable:!0,align:"left"},{name:"contratante",index:"contratante",width:180,sortable:!0,align:"center"},{name:"tipo",index:"tipo",width:120,sortable:!1,align:"center"},{name:"presupuesto_original",index:"presupuesto_original",width:180,formatter:"currency",formatoptions:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,prefix:"$"},sorttype:"float",align:"right"},{name:"monto_adendas",index:"monto_adendas",width:100,formatter:"currency",formatoptions:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,prefix:"$"},sorttype:"float",align:"right"},{name:"presupuesto_total",index:"presupuesto_total",width:150,formatter:"currency",formatoptions:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,prefix:"$"},sorttype:"float",align:"right"},{name:"%_de_Avance",width:120,sorttype:"float",align:"center",formatter:"currency",formatoptions:{thousandsSeparator:",",decimalPlaces:2,suffix:"%"}},{name:"comprometido",index:"comprometido",width:120,formatter:"currency",formatoptions:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,prefix:"$"},sorttype:"float",align:"right"},{name:"gastado",index:"gastado",width:120,formatter:"currency",formatoptions:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,prefix:"$"},sorttype:"float",align:"right"},{name:"pagado",index:"pagado",width:120,formatter:"currency",formatoptions:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,prefix:"$"},sorttype:"float",align:"right"},{name:"presupuestoxgastar",index:"presupuestoxgastar",width:100,formatter:"currency",formatoptions:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,prefix:"$"},sorttype:"float",align:"right"},{name:"anticipos_por_amortizar",index:"anticipos_por_amortizar",width:170,formatter:"currency",formatoptions:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,prefix:"$"},sorttype:"float",align:"right"},{name:"facturado",index:"facturado",width:90,formatter:"currency",formatoptions:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,prefix:"$"},sorttype:"float",align:"right"},{name:"cobrado",index:"cobrado",width:90,formatter:"currency",formatoptions:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,prefix:"$"},sorttype:"float",align:"right"},{name:"update",index:"update",width:170,sortable:!1,formatter:"date",formatoptions:{srcformat:"Y-m-d H:i",newformat:"d-m-Y H:i"},align:"center"},{name:"documentacion",index:"documentacion",width:120,sortable:!1,align:"center",formatter:"showlink",formatoptions:{baseLinkUrl:subfolder+"/documentos",idName:"idCentro"}},{name:"estado",index:"estado",width:120,sortable:!1,align:"center",cellattr:function(t,e,a){return"Activo"===e?'style="background-color:#9ACD32;border-radius:10px;"':"En Revisión"===e?'style="background-color:#FFA500;border-radius:10px;"':"Inactivo"===e?'style="background-color:#A9A9A9;border-radius:10px;"':"Suspendido"===e?'style="background-color:#FF0000;border-radius:10px;"':void 0}},{name:"name",index:"name",width:90,sortable:!1,align:"center"}],n=["id","No. De proyecto","Centro Contable","PM","Tipo","Presupuesto Original","Adendas","Presupuesto Total","% de avance","Comprometido","Gastado","Desembolsado","Presupuesto por gastar","Anticipos por Amortizar","Facturado","Cobrado","Última Actualización","Documentacion","Estado",""];if(!a){d.removeValue("name","anticipos_por_amortizar"),d.removeValue("name","pagado");var s=n.indexOf("Anticipos por Amortizar");s>-1&&n.splice(s,1),s=n.indexOf("Desembolsado"),s>-1&&n.splice(s,1)}if(!o){d.removeValue("name","estado");var s=n.indexOf("Estado");s>-1&&n.splice(s,1)}if(!r){d.removeValue("name","documentacion");var s=n.indexOf("Documentacion");s>-1&&n.splice(s,1)}$("#table_list_1").jqGrid({regional:"en",data:e,datatype:"local",height:700,autowidth:!0,shrinkToFit:!1,rowNum:10,rowList:[10,20,30],colNames:n,colModel:d,pager:"#pager_list_1",viewrecords:!0,gridComplete:function(){for(var t=$("#table_list_1"),e=t.jqGrid("getDataIDs"),a=0;a<e.length;a++){var o=e[a],r='<a data-toggle="modal" class="btn-primary btn-sm" style="color:white;" onclick="loadModal('+o+')">Opciones</a>',i='<a data-toggle="modal" class="" onclick="centroContableModal('+o+')">',d="</a>";if("true"==t.jqGrid("getRowData",o).isLeaf){t.jqGrid("setRowData",o,{name:r});var n=t.jqGrid("getRowData",o).centro;t.jqGrid("setRowData",o,{centro:i+n+d},{background:"white"})}else t.jqGrid("setRowData",o,{estado:""},{background:"white"})}},hidegrid:!1,scrollOffset:0,sortname:"id",treeGrid:!0,treeGridModel:"adjacency",treedatatype:"local",ExpandColumn:"centro",gridview:!0}),$.jgrid.formatter.currency.decimalSeparator=".",$.jgrid.formatter.currency.thousandsSeparator=",",$.jgrid.formatter.currency.decimalPlaces="2",$(window).bind("resize",function(){var t=$(".jqGrid_wrapper").width();$("#table_list_1").setGridWidth(t)}),$("#table_list_1")[0].addJSONData({total:1,page:1,records:e.length,rows:e}),$("#table_list_1").navGrid("#pager_list_1",{edit:!1,add:!1,del:!1,search:!1,refresh:!1}).navButtonAdd("#pager_list_1",{caption:"Expandir / Contraer Todo",onClickButton:function(){$("#table_list_1").find(".treeclick").trigger("click")},position:"last",title:"Expandir / Contraer Todo",cursor:"pointer"}),$("#table_list_1 tbody .jqgrow").each(function(t){e[t].isLeaf||$(this).find("a").removeAttr("href").css("cursor","default").css("color","black").css("textDecoration","none")}),1!=$("#verFacturasCobros").val()&&($("#table_list_1").jqGrid("hideCol",["facturado"]),$("#table_list_1").jqGrid("hideCol",["cobrado"]))}})});