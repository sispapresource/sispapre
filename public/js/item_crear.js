function reloadAmountAdenda(){var t=totalNew=0;$(".amountNew").each(function(t){$(this).val().trim().length>0&&(totalNew+=parseFloat($(this).val()))}),$(".amountOld").each(function(a){$(this).val().trim().length>0&&(t+=parseFloat($(this).val()))});var a=totalNew.toFixed(2)+"";"-0.00"===a&&(a="0.00"),$("#amountAdenda").val(a)}function deleteDiv(t){var a=0;$(".select-table").each(function(t){a+=1}),a>1&&(mydata[$("#select-table"+t).val().split("_")[2]].show=1,$("#select-"+last).empty(),$.each(mydata,function(t,a){1==mydata[t].show&&$("#select-"+last).append('<option value="'+mydata[t].id+"_"+mydata[t].name+"_"+t+'">'+mydata[t].id+" "+mydata[t].cuenta+"</option>")}),$("#div"+t).remove(),reloadAmountAdenda())}function save(t){var a,e,o=[];$(".divDetail").each(function(t){$(this).find(".form-group .input-group .amountNew").val().trim().length>0&&(e={id_cuenta:$(this).find(".form-group .select-table").val().split("_")[0],monto_anterior:$(this).find(".form-group .select-table").val().split("_")[1],monto_nuevo:parseFloat($(this).find(".form-group .input-group .amountNew").val())},o.push(e))}),a=JSON.stringify(o);var n=$("input[name=_token]").val();$("#button-save").prop("disabled",!0),$.ajax({url:subfolder+"/item_guardar",headers:{"X-CSRF-TOKEN":n},type:"GET",data:{idAjuste:t,nro_item:$("#nro_item").val(),observaciones:$("#observaciones").val(),monto:$("#amountAdenda").val(),amounts:a},success:function(a){"success"==a.response?(setTimeout(function(){toastr.options={closeButton:!0,progressBar:!1,positionClass:"toast-top-center",showMethod:"slideDown",timeOut:4e3},toastr.success("Item Creado con Exito")},1300),setTimeout(function(){window.location=subfolder+"/ajuste_detail?idAjuste="+t},2600)):(setTimeout(function(){toastr.options={closeButton:!0,progressBar:!1,positionClass:"toast-top-center",showMethod:"slideDown",timeOut:4e3},toastr.error("Creacion de Item Fallida")},1300),setTimeout(function(){window.location=subfolder+"/ajuste_detail?idAjuste="+t},2600))}})}var mydata=[],updates=[],last="tablesd";$(document).ready(function(){function t(t){$.ajax({url:subfolder+"/cuentasu",headers:{"X-CSRF-TOKEN":a,cuentaFilter:t},type:"GET",datatype:"JSON",data:{nivel:2},success:function(t){$.each(t.cuentas,function(t,a){item={},item.id=a.id_cuenta,item.cuenta=a.nombre_cuenta,item.name=a.presupuesto,item.show=1,mydata.push(item),$("#select-tablesd").append('<option value="'+a.id_cuenta+"_"+a.presupuesto+"_"+t+'">'+a.id_cuenta+" "+a.nombre_cuenta+"</option>")}),$("#modalCargando").modal("hide")}})}$("#modalCargando").modal();var a=$("input[name=_token]").val();t(""),$("#select-tablesd").combobox({select:function(t,a){$("#select-tablesd").trigger("change")}})}),$("#add").click(function(){$("#buttonDelete"+last).show();var t=Math.floor(1e4*Math.random());$("#adendas").append('<div class="row divDetail" id="div'+t+'"><div class="form-group col-sm-3"><label for="inputCuenta" class="btn-block">Cuenta</label><select name="select" class="form-control" id="select-table'+t+'"></select></div><div class="form-group col-sm-3" id="data_1"><label for="inputActualizacion" class="btn-block">Monto actual</label><div class="input-group" id="inputActualizacion" ><span class="usd-off input-group-addon "><i class="fa fa-usd"></i></span><input class="form-control amountOld" type="text" disabled="disabled" id="select-table'+t+'amountOld"></div></div><div class="col-sm-3 form-group"> <label for="inputCuenta" class="btn-block">Costo</label><div class="input-group date" id="inputActualizacion" ><span class="input-group-addon"><i class="fa fa-usd"></i></span><input class="form-control amountNew" type="text" id="select-table'+t+'amountNew"></div></div><div class="col-sm-3 button-top"><button type="button" class="btn btn-gray" id="buttonDeletetable'+t+'" style="display:none;" onclick="deleteDiv('+t+')"><i class="fa fa-trash-o" title="Delete"></i></button></div></div>'),$.each(mydata,function(a,e){$("#select-table"+t).append('<option value="'+mydata[a].id+"_"+mydata[a].name+"_"+a+'">'+mydata[a].id+" "+mydata[a].cuenta+"</option>"),$("#select-table"+t).addClass("select-table")}),last="table"+t,$("#select-table"+t).combobox({select:function(a,e){$("#select-table"+t).trigger("change")}}),$("#select-table"+t).trigger("change")}),$("#adendas").on("change",".select-table",function(){$("#divAdenda").show(),$("#divamountOld").show(),$(".btn-add").show(),$("#"+$(this).attr("id")+"amountOld").val($(this).val().split("_")[1])}),$("#adendas").on("keypress",".amountNew",function(t){if(45!=t.which&&8!=t.which&&0!=t.which&&46!=t.which&&(t.which<48||t.which>57))return!1}),$("#adendas").on("keyup",".amountNew",function(){reloadAmountAdenda()});